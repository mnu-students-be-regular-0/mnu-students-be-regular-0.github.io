<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#3B82F6">
    <meta name="description" content="Ù…Ù†Ø¸Ù… Ø§Ù„Ø¯Ø±Ø§Ø³Ø© - Ù†Ø¸Ù… Ù…ÙˆØ§Ø¯Ùƒ ÙˆÙ…Ø­Ø§Ø¶Ø±Ø§ØªÙƒ Ø¨Ø³Ù‡ÙˆÙ„Ø©">
    <link rel="manifest" id="manifest-placeholder">
    <link rel="apple-touch-icon" href="https://hsynb7590-dev.github.io/Be-Regular-MNU-1/icon.png">
    <title>Ù…Ù†Ø¸Ù… Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</title>
    <style>
        /* Ø³ØªØ§ÙŠÙ„Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #E0F2FE 0%, #DDD6FE 100%); min-height: 100vh; padding: 1rem; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: white; border-radius: 1rem; box-shadow: 0 10px 25px rgba(0,0,0,0.1); padding: 2rem; margin-bottom: 1.5rem; text-align: center; }
        .nav-tabs { display: flex; gap: 1rem; margin-bottom: 1.5rem; overflow-x: auto; padding: 0.5rem; scrollbar-width: none; }
        .nav-tab { background: white; border: none; padding: 0.8rem 1.5rem; border-radius: 0.8rem; color: #4B5563; font-weight: 600; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 6px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 0.5rem; white-space: nowrap; }
        .nav-tab.active { background: #3B82F6; color: white; transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.4); }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Ø³ØªØ§ÙŠÙ„ Ø´Ø¨Ø§Ùƒ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Modal) Ù„Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØªØ§Ø¨Ù„Øª */
        #fileViewModal {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            z-index: 10000; flex-direction: column; align-items: center; justify-content: center; padding: 10px;
        }
        .modal-header { position: absolute; top: 15px; left: 15px; right: 15px; display: flex; justify-content: space-between; align-items: center; width: 95%; }
        .modal-close { background: #ef4444; color: white; border: none; width: 40px; height: 40px; border-radius: 50%; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .modal-download { background: #3b82f6; color: white; padding: 8px 16px; border-radius: 8px; text-decoration: none; font-weight: bold; font-size: 14px; }
        #modalContentContainer { width: 100%; max-width: 900px; height: 80vh; display: flex; justify-content: center; align-items: center; background: #000; border-radius: 12px; overflow: hidden; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 id="app-title">Be Regular</h1>
            <p>Ù†Ø¸Ù… Ù…ÙˆØ§Ø¯Ùƒ ÙˆÙ…Ø­Ø§Ø¶Ø±Ø§ØªÙƒ ÙˆØ£Ø¨Ø­Ø§Ø«Ùƒ ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯</p>
        </header>
        <nav class="nav-tabs">
        <button class="nav-tab active" onclick="showTab('subjects')">ğŸ“š Ø§Ù„Ù…ÙˆØ§Ø¯</button>
        <button class="nav-tab" onclick="showTab('schedule')">ğŸ“… Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
        <button class="nav-tab" onclick="showTab('research')">ğŸ” Ø§Ù„Ø£Ø¨Ø­Ø§Ø«</button>
        <button class="nav-tab" onclick="showTab('settings')">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
    </nav>

    <div id="subjects" class="tab-content active">
        <div class="card">
            <h2 style="margin-bottom:1.5rem">ğŸ“š Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</h2>
            <div class="search-box">
                <input type="text" id="subjectInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©...">
                <button onclick="addSubject()" class="btn btn-primary">Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©</button>
            </div>
        </div>
        <div id="subjectsList" class="grid"></div>
    </div>

    <div id="schedule" class="tab-content">
        <div class="card">
            <h2>ğŸ“… Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</h2>
            <div id="scheduleContainer"></div>
        </div>
    </div>

    <div id="research" class="tab-content">
        <div class="card">
            <h2>ğŸ” Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø¯Ø±Ø§Ø³Ø©</h2>
            <div id="researchContainer"></div>
        </div>
    </div>

    <div id="settings" class="tab-content">
        <div class="card">
            <h2>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</h2>
            <button onclick="exportData()" class="btn btn-primary" style="margin-top:1rem">ğŸ“¥ ØªØµØ¯ÙŠØ± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
            <input type="file" id="importFile" style="display:none" onchange="importData(event)">
            <button onclick="document.getElementById('importFile').click()" class="btn" style="background:#10B981; color:white; margin-top:1rem">ğŸ“¤ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
            <button onclick="clearAllData()" class="btn" style="background:#EF4444; color:white; margin-top:1rem">âš ï¸ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        </div>
    </div>
</div>

<div id="fileViewModal">
    <div class="modal-header">
        <button class="modal-close" onclick="closeFileModal()">âœ•</button>
        <a id="modalDownloadBtn" href="#" download class="modal-download">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù ğŸ“¥</a>
    </div>
    <div id="modalContentContainer"></div>
</div>

<script>
    // Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆÙ‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ù„Ù€ 4
    const DB_NAME = 'BeRegularDB';
    const DB_VERSION = 4;
    let db;
    let subjects = [];

    // ÙØªØ­ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    const request = indexedDB.open(DB_NAME, DB_VERSION);
    request.onerror = (e) => console.error("Database error:", e);
    request.onupgradeneeded = (e) => {
        const db = e.target.result;
        if (!db.objectStoreNames.contains('subjects')) {
            db.createObjectStore('subjects', { keyPath: 'id' });
        }
    };
    request.onsuccess = (e) => {
        db = e.target.result;
        loadData();
    };

    // ÙˆØ¸ÙŠÙØ© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„ØªØ§Ø¨Ù„Øª)
    function viewFile(file) {
        if (!file || !file.data) {
            alert('Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
            return;
        }
        const modal = document.getElementById('fileViewModal');
        const container = document.getElementById('modalContentContainer');
        const dlBtn = document.getElementById('modalDownloadBtn');
        
        container.innerHTML = '<p style="color:white">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù...</p>';
        dlBtn.href = file.data;
        modal.style.display = 'flex';

        setTimeout(() => {
            container.innerHTML = '';
            if (file.type.startsWith('image/')) {
                container.innerHTML = `<img src="${file.data}" style="max-width:100%; max-height:100%; object-fit:contain;">`;
            } else if (file.type === 'application/pdf') {
                container.innerHTML = `<iframe src="${file.data}" style="width:100%; height:100%; border:none; background:white;"></iframe>`;
            } else {
                container.innerHTML = `<p style="color:white">Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø²Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„.</p>`;
            }
        }, 200);
    }

    function closeFileModal() {
        document.getElementById('fileViewModal').style.display = 'none';
        document.getElementById('modalContentContainer').innerHTML = '';
    }
    // ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø°Ù Ø§Ù„Ù…ÙˆØ§Ø¯ ÙˆØ§Ù„Ù…Ù„ÙØ§Øª
    async function addSubject() {
        const input = document.getElementById('subjectInput');
        const name = input.value.trim();
        if (!name) return;
        const newSubject = { id: Date.now(), name: name, files: [] };
        subjects.push(newSubject);
        await saveAll();
        renderSubjects();
        input.value = '';
    }

    async function deleteSubject(id) {
        if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆÙƒÙ„ Ù…Ù„ÙØ§ØªÙ‡Ø§ØŸ')) return;
        subjects = subjects.filter(s => s.id !== id);
        await saveAll();
        renderSubjects();
    }

    async function addFilePrompt(subjectId) {
        const input = document.createElement('input');
        input.type = 'file';
        input.onchange = async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = async (event) => {
                const subject = subjects.find(s => s.id === subjectId);
                if (subject) {
                    subject.files.push({
                        id: Date.now(),
                        name: file.name,
                        type: file.type,
                        data: event.target.result
                    });
                    await saveAll();
                    renderSubjects();
                }
            };
            reader.readAsDataURL(file);
        };
        input.click();
    }

    // Ø­ÙØ¸ ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    async function saveAll() {
        const tx = db.transaction('subjects', 'readwrite');
        const store = tx.objectStore('subjects');
        store.clear();
        subjects.forEach(s => store.put(s));
    }

    function renderSubjects() {
        const list = document.getElementById('subjectsList');
        list.innerHTML = subjects.map(s => `
            <div class="card" style="background:white; padding:1.5rem; border-radius:1rem; margin-bottom:1rem; box-shadow:0 4px 6px rgba(0,0,0,0.05)">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem">
                    <h3 style="color:#1F2937">${s.name}</h3>
                    <button onclick="deleteSubject(${s.id})" style="background:none; border:none; color:#EF4444; cursor:pointer">ğŸ—‘ Ø­Ø°Ù</button>
                </div>
                <div style="display:grid; gap:0.5rem">
                    ${s.files.map(f => `
                        <div onclick='viewFile(${JSON.stringify(f)})' style="padding:0.8rem; background:#F3F4F6; border-radius:0.5rem; cursor:pointer; display:flex; align-items:center; gap:0.5rem">
                            ğŸ“„ <span style="flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap">${f.name}</span>
                        </div>
                    `).join('')}
                    <button onclick="addFilePrompt(${s.id})" style="padding:0.8rem; border:2px dashed #CBD5E1; background:none; border-radius:0.5rem; cursor:pointer; color:#64748B">+ Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ù</button>
                </div>
            </div>
        `).join('');
    }

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù€ Service Worker Ù„Ù„Ø£ÙˆÙÙ„Ø§ÙŠÙ†
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js').then(reg => {
                console.log('SW registered');
            }).catch(err => console.log('SW error:', err));
        });
    }
</script>
</body>
</html>

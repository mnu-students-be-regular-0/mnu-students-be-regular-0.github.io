<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#3B82F6">
  <meta name="description" content="Ù…Ù†Ø¸Ù… Ø§Ù„Ø¯Ø±Ø§Ø³Ø© - Ù†Ø¸Ù… Ù…ÙˆØ§Ø¯Ùƒ ÙˆÙ…Ø­Ø§Ø¶Ø±Ø§ØªÙƒ Ø¨Ø³Ù‡ÙˆÙ„Ø©">
  <link rel="manifest" href="./manifest.json">
  <link rel="apple-touch-icon" href="https://hsynb7590-dev.github.io/Be-Regular-MNU-1/icon.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <title>Ù…Ù†Ø¸Ù… Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</title>
  <style>
    /* â•â• RESET & BASE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
      padding: 1rem;
      background-image: url('https://i.postimg.cc/HxQzPdM1/Create-a-highresolution-2k-202602180610.jpg');
      background-attachment: fixed;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      color: #e2e8f0;
    }
    body::before {
      content: '';
      position: fixed; inset: 0;
      background: rgba(5,8,22,0.55);
      z-index: 0; pointer-events: none;
    }

    .container { max-width: 1200px; margin: 0 auto; position: relative; z-index: 1; }

    /* â•â• GLASSMORPHISM â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .glass {
      background: rgba(15,23,42,0.4);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 1rem;
    }

    /* â•â• HEADER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .header {
      background: rgba(15,23,42,0.45);
      backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(99,179,237,0.15);
      border-radius: 1rem;
      box-shadow: 0 0 40px rgba(56,189,248,0.08), 0 20px 60px rgba(0,0,0,0.4);
      padding: 3rem 2rem; margin-bottom: 1.5rem; text-align: center;
      position: relative; overflow: hidden;
    }
    .header::after {
      content: ''; position: absolute; inset: 0;
      background:
        radial-gradient(ellipse at 30% 50%, rgba(56,189,248,0.07), transparent 60%),
        radial-gradient(ellipse at 70% 50%, rgba(99,102,241,0.07), transparent 60%);
      pointer-events: none;
    }
    .header h1 {
      font-size: 2.5rem; color: #f0f9ff; margin-bottom: 0.5rem;
      position: relative; z-index: 1;
      text-shadow: 0 0 30px rgba(56,189,248,0.5), 0 4px 12px rgba(0,0,0,0.6);
      font-weight: 700; letter-spacing: 1px;
    }
    .header p { color: #94a3b8; position: relative; z-index: 1; font-size: 1.125rem; }

    /* â•â• NAV TABS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .nav-tabs { display: flex; gap: 1rem; margin-bottom: 1.5rem; overflow-x: auto; padding: 0.5rem; }
    .nav-tab {
      background: rgba(15,23,42,0.4);
      backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
      border: 1px solid rgba(255,255,255,0.08); border-radius: 0.75rem;
      padding: 1rem 1.5rem; cursor: pointer; transition: all 0.3s;
      white-space: nowrap; display: flex; align-items: center; gap: 0.5rem;
      font-weight: 600; color: #94a3b8;
    }
    .nav-tab:hover {
      border-color: rgba(56,189,248,0.3); color: #e2e8f0;
      box-shadow: 0 0 18px rgba(56,189,248,0.12); transform: translateY(-2px);
    }
    .nav-tab.active {
      background: rgba(14,50,80,0.55);
      border: 1px solid rgba(56,189,248,0.55); color: #7dd3fc;
      box-shadow: 0 0 12px rgba(56,189,248,0.45), 0 0 30px rgba(56,189,248,0.18),
                  inset 0 0 12px rgba(56,189,248,0.06);
      text-shadow: 0 0 8px rgba(56,189,248,0.8);
    }
    .nav-tab.active i { color: #38bdf8 !important; filter: drop-shadow(0 0 6px rgba(56,189,248,0.9)); }

    /* â•â• CARD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .card {
      background: rgba(15,23,42,0.4);
      backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
      border: 1px solid rgba(255,255,255,0.08); border-radius: 1rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3); padding: 1.5rem; margin-bottom: 1.5rem;
    }

    /* â•â• SUBJECTS GRID â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .subjects-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem; }
    .subject-card {
      background: rgba(15,23,42,0.4);
      backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
      border: 1px solid rgba(255,255,255,0.08); border-radius: 1rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3); padding: 1.5rem;
      transition: all 0.3s; cursor: pointer; position: relative; overflow: hidden;
    }
    .subject-card:hover {
      border-color: rgba(56,189,248,0.4);
      box-shadow: 0 0 20px rgba(56,189,248,0.15), 0 8px 32px rgba(0,0,0,0.4);
      transform: translateY(-4px);
    }
    .subject-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; }
    .subject-image {
      width: 64px; height: 64px; border-radius: 50%; object-fit: cover;
      border: 2px solid rgba(56,189,248,0.4); box-shadow: 0 0 12px rgba(56,189,248,0.2);
    }
    .subject-info h3 { font-size: 1.125rem; color: #e2e8f0; margin-bottom: 0.25rem; }
    .subject-info p { font-size: 0.875rem; color: #64748b; }

    /* â•â• ADD SUBJECT BUTTON â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .add-subject-btn {
      background: rgba(14,50,80,0.35); backdrop-filter: blur(15px);
      color: #7dd3fc; border: 2px dashed rgba(56,189,248,0.4); border-radius: 1rem;
      padding: 3rem; cursor: pointer; display: flex; flex-direction: column;
      align-items: center; gap: 1rem; transition: all 0.3s; min-height: 160px;
      box-shadow: 0 0 20px rgba(56,189,248,0.06);
    }
    .add-subject-btn:hover {
      border-color: rgba(56,189,248,0.8); box-shadow: 0 0 30px rgba(56,189,248,0.25);
      transform: translateY(-4px) scale(1.02); text-shadow: 0 0 10px rgba(56,189,248,0.9);
    }

    /* â•â• BUTTONS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .btn {
      padding: 0.75rem 1.5rem; border: none; border-radius: 0.75rem; cursor: pointer;
      font-size: 1rem; font-weight: 600; transition: all 0.3s;
      display: inline-flex; align-items: center; gap: 0.5rem;
    }
    .btn:hover { transform: translateY(-2px); }
    .btn-primary {
      background: rgba(14,50,80,0.6); color: #7dd3fc;
      border: 1px solid rgba(56,189,248,0.5); box-shadow: 0 0 12px rgba(56,189,248,0.2);
    }
    .btn-primary:hover { box-shadow: 0 0 22px rgba(56,189,248,0.5); border-color: rgba(56,189,248,0.8); text-shadow: 0 0 8px rgba(56,189,248,0.8); }
    .btn-danger {
      background: rgba(80,10,10,0.5); color: #fca5a5;
      border: 1px solid rgba(239,68,68,0.4);
    }
    .btn-danger:hover { box-shadow: 0 0 18px rgba(239,68,68,0.4); }

    /* â•â• INPUTS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .input {
      width: 100%; padding: 0.75rem;
      border: 1px solid rgba(255,255,255,0.1); border-radius: 0.75rem;
      font-size: 1rem; transition: border-color 0.3s;
      background: rgba(15,23,42,0.6); color: #e2e8f0;
    }
    .input:focus { outline: none; border-color: rgba(56,189,248,0.6); box-shadow: 0 0 12px rgba(56,189,248,0.15); }
    .input option { background: #0f172a; color: #e2e8f0; }
    .textarea {
      width: 100%; padding: 0.75rem;
      border: 1px solid rgba(255,255,255,0.1); border-radius: 0.75rem;
      font-size: 1rem; min-height: 120px; resize: vertical; font-family: inherit;
      background: rgba(15,23,42,0.6); color: #e2e8f0;
    }
    .textarea:focus { outline: none; border-color: rgba(56,189,248,0.6); }

    /* â•â• UPLOAD AREA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .upload-area {
      border: 2px dashed rgba(255,255,255,0.15); border-radius: 0.75rem;
      padding: 2rem; text-align: center; cursor: pointer; transition: border-color 0.3s;
      background: rgba(15,23,42,0.3); color: #94a3b8;
    }
    .upload-area:hover { border-color: rgba(56,189,248,0.5); }

    /* â•â• WEEK CARD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .week-card {
      background: rgba(15,23,42,0.4);
      backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
      border: 1px solid rgba(255,255,255,0.08); border-radius: 0.75rem;
      padding: 1rem; margin-bottom: 1rem; transition: all 0.3s;
    }
    .week-card:hover { border-color: rgba(56,189,248,0.25); box-shadow: 0 0 16px rgba(56,189,248,0.08); }
    .week-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
    .week-files { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.75rem; }
    .file-upload {
      border: 1px dashed rgba(255,255,255,0.15); border-radius: 0.5rem; padding: 0.75rem;
      text-align: center; cursor: pointer; background: rgba(15,23,42,0.3); color: #94a3b8; transition: all 0.3s;
    }
    .file-upload:hover { border-color: rgba(56,189,248,0.4); }
    .file-uploaded { background: rgba(15,23,42,0.5); padding: 0.5rem; border-radius: 0.5rem; display: flex; flex-direction: column; gap: 0.25rem; align-items: center; }
    .file-name { font-size: 0.7rem; color: #34d399; text-align: center; word-break: break-all; max-width: 100%; }
    .file-open-btn {
      background: rgba(16,185,129,0.3); color: #34d399; border: 1px solid rgba(52,211,153,0.4);
      padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.7rem; cursor: pointer; margin-top: 0.25rem; transition: all 0.2s;
    }
    .file-open-btn:hover { background: rgba(16,185,129,0.5); box-shadow: 0 0 8px rgba(52,211,153,0.4); }

    .upload-preview { position: relative; display: inline-block; }
    .upload-preview img { max-width: 100%; border-radius: 0.75rem; }
    .delete-btn {
      background: rgba(239,68,68,0.4); color: #fca5a5; border: none; border-radius: 50%;
      width: 32px; height: 32px; cursor: pointer; display: flex; align-items: center;
      justify-content: center; font-size: 1.2rem; transition: all 0.2s;
    }
    .delete-btn:hover { background: rgba(239,68,68,0.7); box-shadow: 0 0 10px rgba(239,68,68,0.5); }

    .hidden { display: none !important; }
    .back-btn { color: #38bdf8; cursor: pointer; font-size: 1rem; margin-bottom: 1rem; display: inline-block; text-shadow: 0 0 8px rgba(56,189,248,0.5); }
    .back-btn:hover { color: #7dd3fc; }

    /* â•â• EXAM TABLE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .exam-schedule-table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    .exam-schedule-table th, .exam-schedule-table td { padding: 1rem; text-align: right; border-bottom: 1px solid rgba(255,255,255,0.06); color: #e2e8f0; }
    .exam-schedule-table th { background: rgba(14,50,80,0.5); color: #7dd3fc; font-weight: 600; text-shadow: 0 0 8px rgba(56,189,248,0.4); }
    .exam-schedule-table tr:hover td { background: rgba(56,189,248,0.04); }
    .exam-type-badge { display: inline-block; padding: 0.25rem 0.75rem; border-radius: 0.5rem; font-size: 0.875rem; font-weight: 600; }
    .badge-mid  { background: rgba(245,158,11,0.15); color: #fbbf24; border: 1px solid rgba(245,158,11,0.3); }
    .badge-final{ background: rgba(56,189,248,0.1); color: #7dd3fc; border: 1px solid rgba(56,189,248,0.3); }

    /* â•â• SEARCH â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .search-input {
      width: 100%; padding: 1rem; border: 1px solid rgba(56,189,248,0.2); border-radius: 0.75rem;
      font-size: 1.125rem; transition: all 0.3s; margin-bottom: 1.5rem;
      background: rgba(15,23,42,0.6); color: #e2e8f0;
    }
    .search-input::placeholder { color: #475569; }
    .search-input:focus { outline: none; border-color: rgba(56,189,248,0.6); box-shadow: 0 0 18px rgba(56,189,248,0.15); }

    /* â•â• RESEARCH CARDS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .research-card {
      background: rgba(15,23,42,0.4);
      backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
      border: 1px solid rgba(255,255,255,0.08); border-radius: 1rem;
      padding: 1.5rem; margin-bottom: 1rem; transition: all 0.3s;
    }
    .research-card:hover { border-color: rgba(56,189,248,0.3); box-shadow: 0 0 16px rgba(56,189,248,0.1); }
    .research-card h3 { color: #e2e8f0; margin-bottom: 0.5rem; }
    .research-card p  { color: #64748b; margin-bottom: 1rem; }
    .research-links { display: flex; gap: 0.5rem; flex-wrap: wrap; }
    .research-link {
      background: rgba(14,50,80,0.5); color: #38bdf8; padding: 0.5rem 1rem; border-radius: 0.5rem;
      text-decoration: none; font-weight: 600; transition: all 0.3s; border: 1px solid rgba(56,189,248,0.35);
    }
    .research-link:hover { background: rgba(56,189,248,0.15); box-shadow: 0 0 14px rgba(56,189,248,0.35); }

    /* â•â• ADD EXAM BTN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .add-exam-btn {
      background: rgba(6,40,20,0.5); color: #34d399; padding: 0.75rem 1.5rem;
      border: 1px solid rgba(52,211,153,0.4); border-radius: 0.75rem; cursor: pointer;
      font-size: 1rem; font-weight: 600; transition: all 0.3s;
    }
    .add-exam-btn:hover { box-shadow: 0 0 18px rgba(52,211,153,0.4); border-color: rgba(52,211,153,0.7); }

    /* â•â• EXAM SECTION BOXES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .exam-section-box { background: rgba(15,23,42,0.35); border: 1px solid rgba(255,255,255,0.06); border-radius: 0.75rem; padding: 1.5rem; margin-bottom: 2rem; }
    .exam-section-box h3 { color: #e2e8f0; margin-bottom: 1rem; }

    /* â•â• SALAWAT BTN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .salawat-btn { color: #34d399; font-size: 0.875rem; cursor: pointer; transition: all 0.2s; }
    .salawat-btn:hover { text-shadow: 0 0 8px rgba(52,211,153,0.8); }

    /* â•â• BRV MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .brv-modal { position: fixed; inset: 0; background: rgba(3,7,18,0.97); z-index: 10000; display: flex; flex-direction: column; }
    .brv-header {
      background: rgba(15,23,42,0.9); backdrop-filter: blur(20px); padding: 1rem;
      display: flex; justify-content: space-between; align-items: center; gap: .75rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5); flex-shrink: 0;
      border-bottom: 1px solid rgba(56,189,248,0.15);
    }
    .brv-title { color: #e2e8f0; font-size: 1rem; font-weight: 600; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; flex: 1; }
    .brv-actions { display: flex; gap: .5rem; flex-shrink: 0; }
    .brv-btn { border: none; border-radius: .5rem; padding: .6rem 1rem; cursor: pointer; font-weight: 600; font-size: .875rem; transition: all .2s; }
    .brv-btn-dl    { background: rgba(6,40,20,0.5); color: #34d399; border: 1px solid rgba(52,211,153,0.4); }
    .brv-btn-dl:hover { box-shadow: 0 0 14px rgba(52,211,153,0.4); }
    .brv-btn-close { background: rgba(80,10,10,0.5); color: #fca5a5; border: 1px solid rgba(239,68,68,0.4); }
    .brv-btn-close:hover { box-shadow: 0 0 14px rgba(239,68,68,0.4); }
    .brv-content { flex: 1; overflow-y: auto; overflow-x: hidden; -webkit-overflow-scrolling: touch; background: #05090f; padding: 1rem; }
    .brv-loading { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 300px; color: #94a3b8; gap: 1rem; text-align: center; }
    .brv-layer-badge { font-size: .75rem; background: rgba(56,189,248,0.1); color: #38bdf8; padding: .25rem .75rem; border-radius: 1rem; border: 1px solid rgba(56,189,248,0.25); }
    .brv-spinner { width: 50px; height: 50px; border: 3px solid rgba(56,189,248,0.15); border-top-color: #38bdf8; border-radius: 50%; animation: brv-spin 1s linear infinite; box-shadow: 0 0 16px rgba(56,189,248,0.3); }
    @keyframes brv-spin { to { transform: rotate(360deg); } }
    .brv-page-canvas { width: 100%; max-width: 100%; display: block; margin-bottom: 4px; background: #fff; }
    .brv-page-count { text-align: center; color: #94a3b8; padding: .5rem; font-size: .875rem; margin-bottom: .5rem; }
    .brv-iframe { width: 100%; height: 80vh; border: none; display: block; background: #fff; }
    .brv-dl-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 300px; background: rgba(15,23,42,0.8); border: 1px solid rgba(56,189,248,0.15); border-radius: 1rem; padding: 3rem; margin: auto; max-width: 400px; text-align: center; color: #e2e8f0; }

    /* â•â• HIGHLIGHT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .highlight-yellow { background-color: rgba(254,240,138,0.25); color: #fef08a; }
    .highlight-green  { background-color: rgba(187,247,208,0.2);  color: #86efac; }
    .highlight-blue   { background-color: rgba(191,219,254,0.2);  color: #93c5fd; }
    .highlight-pink   { background-color: rgba(251,207,232,0.2);  color: #f9a8d4; }

    /* â•â• SCROLLBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: rgba(15,23,42,0.3); }
    ::-webkit-scrollbar-thumb { background: rgba(56,189,248,0.3); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(56,189,248,0.6); }

    /* â•â• NOTIFICATION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #notification {
      position: fixed; top: 2rem; right: 2rem;
      background: rgba(6,40,20,0.7); backdrop-filter: blur(12px);
      color: #34d399; padding: 1rem 1.5rem; border-radius: .75rem;
      border: 1px solid rgba(52,211,153,0.4); box-shadow: 0 0 20px rgba(52,211,153,0.3);
      z-index: 20000; font-weight: 600;
    }
    @keyframes slideIn  { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }

    /* â•â• OFFLINE BANNER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #offline-banner {
      display: none; position: fixed; bottom: 1rem; left: 50%; transform: translateX(-50%);
      background: rgba(245,158,11,0.15); color: #fbbf24;
      border: 1px solid rgba(245,158,11,0.4); border-radius: 0.75rem;
      padding: 0.75rem 1.5rem; z-index: 19999; font-weight: 600; backdrop-filter: blur(12px);
    }
  </style>
</head>
<body>

  <!-- Offline banner -->
  <div id="offline-banner">ğŸ“¡ Ø£Ù†Øª Ø£ÙˆÙÙ„Ø§ÙŠÙ† â€” Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠØ§Ù‹</div>

  <div class="container">
    <!-- HEADER -->
    <div class="header">
      <h1>Ù…Ù†Ø¸Ù… Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</h1>
      <p>Ù†Ø¸Ù… Ù…ÙˆØ§Ø¯Ùƒ ÙˆÙ…Ø­Ø§Ø¶Ø±Ø§ØªÙƒ Ø¨Ø³Ù‡ÙˆÙ„Ø©</p>
    </div>

    <!-- NAV TABS -->
    <div class="nav-tabs">
      <div class="nav-tab active" id="tab-subjects"><i class="fas fa-book" style="color:#38bdf8;"></i> Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</div>
      <div class="nav-tab" id="tab-exams"><i class="fas fa-calendar-alt" style="color:#a78bfa;"></i> Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</div>
      <div class="nav-tab" id="tab-research"><i class="fas fa-search" style="color:#34d399;"></i> Ø§Ù„Ø¨Ø­Ø«</div>
    </div>

    <!-- â•â• SUBJECTS TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="subjectsTab">
      <div id="mainView">
        <div class="subjects-grid" id="subjectsGrid">
          <div class="add-subject-btn" id="addSubjectBtn">
            <i class="fas fa-plus-circle" style="font-size:3rem;filter:drop-shadow(0 0 8px rgba(56,189,248,0.7));"></i>
            <span style="font-size:1.125rem;font-weight:700;">Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
          </div>
        </div>
      </div>

      <div id="addSubjectForm" class="card hidden">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
          <h2 style="color:#e2e8f0;">Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
          <button id="closeSubjectForm" style="border:none;background:none;cursor:pointer;font-size:1.5rem;color:#94a3b8;">Ã—</button>
        </div>
        <div style="display:flex;flex-direction:column;gap:1rem;">
          <input type="text" id="subjectName" class="input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©">
          <input type="text" id="doctorName" class="input" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙƒØªÙˆØ±/Ø§Ù„Ø¯ÙƒØªÙˆØ±Ø©">
          <div class="upload-area" id="uploadImageArea">
            <div id="subjectImagePreview"></div>
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="rgba(56,189,248,0.5)" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
            <p style="color:#64748b;margin-top:0.5rem;">Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ù…Ø§Ø¯Ø©</p>
            <input type="file" id="subjectImageInput" accept="image/*" class="hidden">
          </div>
          <button class="btn btn-primary" id="saveSubjectBtn">Ø­ÙØ¸ Ø§Ù„Ù…Ø§Ø¯Ø©</button>
        </div>
      </div>

      <div id="subjectView" class="card hidden"></div>
    </div>

    <!-- â•â• EXAMS TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="examsTab" class="hidden">
      <div class="card">
        <h2 style="margin-bottom:1.5rem;color:#e2e8f0;">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª ÙˆØ§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</h2>

        <div class="exam-section-box" style="border-color:rgba(52,211,153,0.12);">
          <h3>ğŸ“… ØµÙˆØ±Ø© Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</h3>
          <div class="upload-area" id="lectureScheduleArea" style="min-height:150px;">
            <div id="lectureSchedulePreview">ğŸ“¤ Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</div>
            <input type="file" id="lectureScheduleInput" accept="image/*" class="hidden">
          </div>
        </div>

        <div class="exam-section-box" style="border-color:rgba(251,191,36,0.12);">
          <h3 style="color:#fbbf24;">ğŸ“¸ ØµÙˆØ± Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</h3>
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1rem;">
            <div>
              <h4 style="font-size:.875rem;margin-bottom:.5rem;color:#64748b;">ØµÙˆØ±Ø© Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙŠØ¯ ØªÙŠØ±Ù…</h4>
              <div class="upload-area" id="midExamScheduleArea" style="min-height:150px;">
                <div id="midExamSchedulePreview">ğŸ“¤ Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙŠØ¯ ØªÙŠØ±Ù…</div>
                <input type="file" id="midExamScheduleInput" accept="image/*" class="hidden">
              </div>
            </div>
            <div>
              <h4 style="font-size:.875rem;margin-bottom:.5rem;color:#64748b;">ØµÙˆØ±Ø© Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙØ§ÙŠÙ†Ø§Ù„</h4>
              <div class="upload-area" id="finalExamScheduleArea" style="min-height:150px;">
                <div id="finalExamSchedulePreview">ğŸ“¤ Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙØ§ÙŠÙ†Ø§Ù„</div>
                <input type="file" id="finalExamScheduleInput" accept="image/*" class="hidden">
              </div>
            </div>
          </div>
        </div>

        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;">
          <h3 style="color:#e2e8f0;">Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ© ÙŠØ¯ÙˆÙŠØ§Ù‹</h3>
          <button class="add-exam-btn" id="addExamBtn">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù…ØªØ­Ø§Ù†</button>
        </div>
        <div id="addExamForm" class="hidden" style="margin-bottom:2rem;padding:1.5rem;background:rgba(15,23,42,0.5);border:1px solid rgba(255,255,255,0.06);border-radius:.75rem;">
          <h3 style="margin-bottom:1rem;color:#e2e8f0;">Ø¥Ø¶Ø§ÙØ© Ø§Ù…ØªØ­Ø§Ù† Ø¬Ø¯ÙŠØ¯</h3>
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:1rem;">
            <select id="examSubject" class="input"><option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option></select>
            <select id="examType" class="input"><option value="mid">Ù…ÙŠØ¯ ØªÙŠØ±Ù…</option><option value="final">ÙØ§ÙŠÙ†Ø§Ù„</option></select>
            <input type="date" id="examDate" class="input">
            <input type="time" id="examTime" class="input">
          </div>
          <div style="display:flex;gap:.5rem;">
            <button class="btn btn-primary" id="saveExamBtn">Ø­ÙØ¸</button>
            <button class="btn" style="background:rgba(30,41,59,0.6);color:#94a3b8;border:1px solid rgba(255,255,255,0.1);" id="cancelExamBtn">Ø¥Ù„ØºØ§Ø¡</button>
          </div>
        </div>
        <table class="exam-schedule-table" id="examTable">
          <thead><tr><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„ÙˆÙ‚Øª</th><th>ØµÙˆØ±Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
          <tbody id="examTableBody"><tr><td colspan="6" style="text-align:center;color:#475569;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©</td></tr></tbody>
        </table>
      </div>
    </div>

    <!-- â•â• RESEARCH TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="researchTab" class="hidden">
      <div class="card">
        <h2 style="margin-bottom:1.5rem;color:#e2e8f0;">Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ§Ø±Ø¯ Ø¯Ø±Ø§Ø³ÙŠØ©</h2>

        <!-- Backup / Restore -->
        <div style="background:rgba(15,23,42,0.4);border:1px solid rgba(251,191,36,0.15);border-radius:1rem;padding:1.5rem;margin-bottom:2rem;">
          <h3 style="margin-bottom:1rem;color:#fbbf24;display:flex;align-items:center;gap:.5rem;">ğŸ’¾ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙˆØ§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
          <p style="color:#64748b;margin-bottom:1rem;line-height:1.6;">Ø§Ø­Ù…Ù Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ù† Ø§Ù„Ø¶ÙŠØ§Ø¹! Ù‚Ù… Ø¨ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ù…ÙˆØ§Ø¯Ùƒ ÙˆÙ…Ø­Ø§Ø¶Ø±Ø§ØªÙƒ ÙˆØµÙˆØ±Ùƒ ÙÙŠ Ù…Ù„Ù ÙˆØ§Ø­Ø¯.</p>
          <div style="display:flex;gap:.75rem;flex-wrap:wrap;">
            <button id="exportDataBtn" style="background:rgba(6,40,20,0.5);color:#34d399;border:1px solid rgba(52,211,153,0.4);padding:.875rem 1.5rem;border-radius:.75rem;cursor:pointer;font-weight:600;font-size:1rem;transition:all .3s;">ğŸ“¦ ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            <button id="importDataBtn" style="background:rgba(14,50,80,0.5);color:#7dd3fc;border:1px solid rgba(56,189,248,0.4);padding:.875rem 1.5rem;border-radius:.75rem;cursor:pointer;font-weight:600;font-size:1rem;transition:all .3s;">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            <input type="file" id="importFileInput" accept=".json" style="display:none;">
          </div>
        </div>

        <input type="text" id="searchInput" class="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø§Ø¯Ø©ØŒ Ù…ÙˆØ¶ÙˆØ¹ØŒ Ø£Ùˆ Ø£ÙŠ Ø´ÙŠØ¡ ØªØ­ØªØ§Ø¬Ù‡...">

        <div id="searchResults">
          <div id="searchResultsContent"><h3 style="margin-bottom:1rem;color:#64748b;">Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…ÙÙŠØ¯Ø© Ù„Ù„Ø¨Ø­Ø«:</h3></div>
          <div class="research-card"><h3>ğŸ““ Notebook LM</h3><p>Ø£Ø¯Ø§Ø© Ø°ÙƒÙŠØ© Ù…Ù† Google Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆØ§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p><div class="research-links"><a href="https://notebooklm.google.com" target="_blank" class="research-link">Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹</a></div></div>
          <div class="research-card"><h3>ğŸŒ´ Jungle AI</h3><p>Ø¨Ø·Ø§Ù‚Ø§Øª ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø°ÙƒÙŠØ© Ù…Ø¯Ø¹ÙˆÙ…Ø© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p><div class="research-links"><a href="https://jungleai.com" target="_blank" class="research-link">Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹</a></div></div>
          <div class="research-card"><h3>âœï¸ Ù…Ø­ÙˆÙ„ Ø§Ù„Ù†ØµÙˆØµ ÙˆØ§Ù„Ø£Ø³Ø¦Ù„Ø©</h3><p>Ø£Ø¯Ø§Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†ØµÙˆØµ Ù…Ù† PDF Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„ØªØ¸Ù„ÙŠÙ„</p><div class="research-links"><a href="#" id="openTextConverterBtn" class="research-link">ÙØªØ­ Ø§Ù„Ø£Ø¯Ø§Ø©</a></div></div>
          <div class="research-card"><h3>ğŸ–¼ï¸ Ù…Ø­ÙˆÙ„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ PDF</h3><p>Ø­ÙˆÙ‘Ù„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ Ù…Ù„Ù PDF ÙˆØ§Ø­Ø¯ Ø¨Ø³Ù‡ÙˆÙ„Ø©</p><div class="research-links"><a href="https://www.ilovepdf.com/jpg_to_pdf" target="_blank" class="research-link">ÙØªØ­ Ø§Ù„Ø£Ø¯Ø§Ø©</a></div></div>
          <div class="research-card"><h3>ğŸ• Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</h3><p>Ø­Ø¯Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ©</p><div class="research-links"><a href="#" id="openOnlineLecturesBtn" class="research-link">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</a></div></div>
          <div class="research-card"><h3>ğŸ“– Google Scholar</h3><p>Ù…Ø­Ø±Ùƒ Ø¨Ø­Ø« Ù„Ù„Ø£ÙˆØ±Ø§Ù‚ Ø§Ù„Ø¹Ù„Ù…ÙŠØ© ÙˆØ§Ù„Ø£Ø¨Ø­Ø§Ø« Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©</p><div class="research-links"><a href="https://scholar.google.com" target="_blank" class="research-link">Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹</a></div></div>
          <div class="research-card"><h3>ğŸ“ Wikipedia</h3><p>Ù…ÙˆØ³ÙˆØ¹Ø© Ø­Ø±Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</p><div class="research-links"><a href="https://ar.wikipedia.org" target="_blank" class="research-link">Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</a><a href="https://en.wikipedia.org" target="_blank" class="research-link">Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</a></div></div>
        </div>
      </div>
    </div>
  </div><!-- /container -->

  <!-- BRV Modal -->
  <div id="brv-modal" class="brv-modal" style="display:none;">
    <div class="brv-header">
      <span class="brv-title" id="brv-title">Ø§Ù„Ù…Ù„Ù</span>
      <div class="brv-actions">
        <button class="brv-btn brv-btn-dl" id="brv-download-btn">ğŸ“¥ ØªØ­Ù…ÙŠÙ„</button>
        <button class="brv-btn brv-btn-close" id="brv-close-btn">âœ• Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
    <div class="brv-content" id="brv-content"></div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       JAVASCRIPT
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <script>
    /* â”€â”€ Service Worker Registration (Standard â€” works on mobile/tablet) â”€ */
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js', { scope: './' })
          .then(reg => {
            console.log('[SW] Registered, scope:', reg.scope);
            reg.addEventListener('updatefound', () => {
              const newSW = reg.installing;
              newSW.addEventListener('statechange', () => {
                if (newSW.state === 'installed' && navigator.serviceWorker.controller) {
                  showNotification('ğŸ”„ ØªØ­Ø¯ÙŠØ« Ù…ØªØ§Ø­ â€” Ø£Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù„Ù„ØªÙØ¹ÙŠÙ„', 4000);
                }
              });
            });
          })
          .catch(err => console.warn('[SW] Registration failed:', err));
      });
    }

    /* â”€â”€ Offline / Online banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const offlineBanner = document.getElementById('offline-banner');
    function updateOnlineStatus() {
      offlineBanner.style.display = navigator.onLine ? 'none' : 'block';
    }
    window.addEventListener('online',  updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);
    updateOnlineStatus();

    /* â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    let subjects = [], exams = [], currentSubject = null, newSubjectImage = null;
    let examScheduleImages = { mid: null, final: null };
    let onlineLectures = [], notificationPermission = false;
    let lectureScheduleImage = null;

    const defaultSubjectImages = [
      'https://images.unsplash.com/photo-1481627834876-b7833e8f5570?q=80&w=800',
      'https://images.unsplash.com/photo-1456513080510-7bf3a84b82f8?q=80&w=800',
      'https://images.unsplash.com/photo-1503676260728-1c00da094a0b?q=80&w=800',
      'https://images.unsplash.com/photo-1488190211105-8b0e65b80b4e?q=80&w=800',
      'https://images.unsplash.com/photo-1519389950473-47ba0277781c?q=80&w=800',
    ];
    const getRandomSubjectImage = () => defaultSubjectImages[Math.floor(Math.random() * defaultSubjectImages.length)];

    /* â”€â”€ IndexedDB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    let db;
    function initDB() {
      return new Promise((res, rej) => {
        const r = indexedDB.open('StudyOrganizerDB', 6);
        r.onerror = () => rej(r.error);
        r.onsuccess = () => { db = r.result; res(db); };
        r.onupgradeneeded = e => {
          db = e.target.result;
          ['subjects','exams','settings','lectures'].forEach(s => {
            if (!db.objectStoreNames.contains(s))
              db.createObjectStore(s, s === 'settings' ? undefined : { keyPath: 'id' });
          });
        };
      });
    }
    async function saveToIDB(store, data) {
      return new Promise((res, rej) => {
        const tx = db.transaction([store], 'readwrite'), s = tx.objectStore(store);
        if (Array.isArray(data)) { s.clear(); data.forEach(i => s.put(i)); }
        else s.put(data, 'scheduleImages');
        tx.oncomplete = () => res(); tx.onerror = () => rej(tx.error);
      });
    }
    async function loadFromIDB(store) {
      return new Promise((res, rej) => {
        const tx = db.transaction([store], 'readonly'), r = tx.objectStore(store).getAll();
        r.onsuccess = () => res(r.result); r.onerror = () => rej(r.error);
      });
    }
    async function loadSettingsIDB() {
      return new Promise((res, rej) => {
        const tx = db.transaction(['settings'], 'readonly'), r = tx.objectStore('settings').get('scheduleImages');
        r.onsuccess = () => res(r.result || { mid: null, final: null }); r.onerror = () => rej(r.error);
      });
    }
    async function loadLectureScheduleIDB() {
      return new Promise(res => {
        try {
          const tx = db.transaction(['settings'], 'readonly'), r = tx.objectStore('settings').get('lectureScheduleImage');
          r.onsuccess = () => res(r.result || null); r.onerror = () => res(null);
        } catch { res(null); }
      });
    }
    async function saveLectureScheduleIDB() {
      try {
        const tx = db.transaction(['settings'], 'readwrite');
        tx.objectStore('settings').put(lectureScheduleImage, 'lectureScheduleImage');
      } catch(e) { console.error(e); }
    }

    /* â”€â”€ App init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    window.addEventListener('load', async () => {
      try {
        await initDB();
        const [ss, es, sci, ls] = await Promise.all([
          loadFromIDB('subjects'), loadFromIDB('exams'), loadSettingsIDB(), loadFromIDB('lectures')
        ]);
        subjects        = ss.length ? ss : JSON.parse(localStorage.getItem('studyOrganizerData')  || '[]');
        exams           = es.length ? es : JSON.parse(localStorage.getItem('studyOrganizerExams') || '[]');
        examScheduleImages = (sci && (sci.mid||sci.final)) ? sci : JSON.parse(localStorage.getItem('studyOrganizerScheduleImages') || '{"mid":null,"final":null}');
        onlineLectures  = ls.length ? ls : JSON.parse(localStorage.getItem('studyOrganizerLectures') || '[]');
        lectureScheduleImage = await loadLectureScheduleIDB();
        if (subjects.length) await saveData();
      } catch {
        subjects           = JSON.parse(localStorage.getItem('studyOrganizerData')  || '[]');
        exams              = JSON.parse(localStorage.getItem('studyOrganizerExams') || '[]');
        examScheduleImages = JSON.parse(localStorage.getItem('studyOrganizerScheduleImages') || '{"mid":null,"final":null}');
        onlineLectures     = JSON.parse(localStorage.getItem('studyOrganizerLectures') || '[]');
      }
      renderSubjects(); updateExamSubjectDropdown(); setupEventListeners();
      document.getElementById('openTextConverterBtn').addEventListener('click', e => { e.preventDefault(); openTextConverter(); });
      document.getElementById('openOnlineLecturesBtn').addEventListener('click', e => { e.preventDefault(); openOnlineLectures(); });
      document.getElementById('exportDataBtn').addEventListener('click', exportAllData);
      document.getElementById('importDataBtn').addEventListener('click', () => document.getElementById('importFileInput').click());
      document.getElementById('importFileInput').addEventListener('change', importAllData);
      document.getElementById('searchInput').addEventListener('input', handleSearch);
      checkUpcomingLectures(); setInterval(checkUpcomingLectures, 60000);
    });

    /* â”€â”€ Save â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    async function saveData() {
      try {
        await Promise.all([
          saveToIDB('subjects', subjects),
          saveToIDB('exams', exams),
          saveToIDB('settings', examScheduleImages),
          saveToIDB('lectures', onlineLectures),
        ]);
      } catch(e) { console.error(e); }
    }
    window.addEventListener('beforeunload', () => saveData());
    setInterval(() => saveData(), 180000);

    /* â”€â”€ Image compression â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function compressImage(b64, maxW = 800, q = 0.65) {
      return new Promise(res => {
        const img = new Image();
        img.onload = () => {
          const c = document.createElement('canvas');
          let w = img.width, h = img.height;
          if (w > maxW) { h = h * maxW / w; w = maxW; }
          c.width = w; c.height = h;
          c.getContext('2d').drawImage(img, 0, 0, w, h);
          res(c.toDataURL('image/jpeg', q));
        };
        img.src = b64;
      });
    }

    /* â”€â”€ Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function setupEventListeners() {
      document.getElementById('tab-subjects').addEventListener('click', () => switchTab('subjects'));
      document.getElementById('tab-exams').addEventListener('click',    () => switchTab('exams'));
      document.getElementById('tab-research').addEventListener('click', () => switchTab('research'));
      document.getElementById('addSubjectBtn').addEventListener('click', showAddSubjectForm);
      document.getElementById('closeSubjectForm').addEventListener('click', hideAddSubjectForm);
      document.getElementById('saveSubjectBtn').addEventListener('click', saveSubject);
      document.getElementById('uploadImageArea').addEventListener('click', () => document.getElementById('subjectImageInput').click());
      document.getElementById('subjectImageInput').addEventListener('change', previewSubjectImage);
      document.getElementById('addExamBtn').addEventListener('click', () => document.getElementById('addExamForm').classList.remove('hidden'));
      document.getElementById('cancelExamBtn').addEventListener('click', hideAddExamForm);
      document.getElementById('saveExamBtn').addEventListener('click', addExamToSchedule);
      document.getElementById('midExamScheduleArea').addEventListener('click',   () => document.getElementById('midExamScheduleInput').click());
      document.getElementById('finalExamScheduleArea').addEventListener('click', () => document.getElementById('finalExamScheduleInput').click());
      document.getElementById('midExamScheduleInput').addEventListener('change',   e => handleScheduleImageUpload(e, 'mid'));
      document.getElementById('finalExamScheduleInput').addEventListener('change', e => handleScheduleImageUpload(e, 'final'));
    }

    function switchTab(tab) {
      document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
      document.getElementById(`tab-${tab}`).classList.add('active');
      ['subjectsTab','examsTab','researchTab'].forEach(id => document.getElementById(id).classList.add('hidden'));
      if (tab === 'subjects') {
        document.getElementById('subjectsTab').classList.remove('hidden');
      } else if (tab === 'exams') {
        document.getElementById('examsTab').classList.remove('hidden');
        renderExamSchedule(); renderScheduleImages(); renderLectureScheduleImage();
        /* re-attach lecture schedule upload listener */
        const la = document.getElementById('lectureScheduleArea');
        const newLa = la.cloneNode(true); la.parentNode.replaceChild(newLa, la);
        newLa.addEventListener('click', () => document.getElementById('lectureScheduleInput').click());
        document.getElementById('lectureScheduleInput').addEventListener('change', async e => {
          const file = e.target.files[0]; if (!file) return;
          const reader = new FileReader();
          reader.onload = async ev => {
            lectureScheduleImage = await compressImage(ev.target.result, 900, 0.7);
            await saveLectureScheduleIDB(); renderLectureScheduleImage();
            showNotification('ØªÙ… Ø­ÙØ¸ ØµÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ âœ“');
          };
          reader.readAsDataURL(file);
        });
      } else {
        document.getElementById('researchTab').classList.remove('hidden');
      }
    }

    /* â”€â”€ Lecture schedule image â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function renderLectureScheduleImage() {
      const p = document.getElementById('lectureSchedulePreview'); if (!p) return;
      p.innerHTML = lectureScheduleImage
        ? `<div style="position:relative;"><img src="${lectureScheduleImage}" style="max-width:100%;border-radius:.5rem;cursor:pointer;border:1px solid rgba(56,189,248,0.2);" onclick="viewLectureScheduleImage()"><button class="delete-btn" onclick="deleteLectureScheduleImage()" style="position:absolute;top:.5rem;left:.5rem;">Ã—</button></div>`
        : 'ğŸ“¤ Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª';
    }
    function viewLectureScheduleImage() {
      if (!lectureScheduleImage) return;
      brvCurrentFile = { data: lectureScheduleImage, name: 'Ø¬Ø¯ÙˆÙ„-Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª.jpg' };
      showBRVModal(brvCurrentFile.name); brvShowImage(lectureScheduleImage);
    }
    async function deleteLectureScheduleImage() {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ØµÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ØŸ')) return;
      lectureScheduleImage = null; await saveLectureScheduleIDB();
      renderLectureScheduleImage(); showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø© âœ“');
    }

    /* â”€â”€ Add subject form â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function showAddSubjectForm() {
      document.getElementById('addSubjectForm').classList.remove('hidden');
      document.getElementById('mainView').classList.add('hidden');
    }
    function hideAddSubjectForm() {
      document.getElementById('addSubjectForm').classList.add('hidden');
      document.getElementById('mainView').classList.remove('hidden');
      document.getElementById('subjectName').value = '';
      document.getElementById('doctorName').value  = '';
      document.getElementById('subjectImagePreview').innerHTML = '';
      newSubjectImage = null;
    }
    async function previewSubjectImage(e) {
      const file = e.target.files[0]; if (!file) return;
      const reader = new FileReader();
      reader.onload = async ev => {
        newSubjectImage = await compressImage(ev.target.result, 500, 0.65);
        document.getElementById('subjectImagePreview').innerHTML =
          `<img src="${newSubjectImage}" style="max-width:200px;border-radius:50%;border:2px solid rgba(56,189,248,0.4);">`;
      };
      reader.readAsDataURL(file);
    }
    function saveSubject() {
      const name   = document.getElementById('subjectName').value.trim();
      const doctor = document.getElementById('doctorName').value.trim();
      if (!name || !doctor) { alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆØ§Ø³Ù… Ø§Ù„Ø¯ÙƒØªÙˆØ±'); return; }
      subjects.push({
        id: Date.now(), name, doctor,
        image: newSubjectImage,
        defaultImage: newSubjectImage ? null : getRandomSubjectImage(),
        weeks: [], practicalExam: null, oralExam: null,
        doctorQuestions: null, doctorQuestionsName: null,
        additionalDoctorFiles: [], myQuestions: '', questionImages: [],
      });
      saveData(); renderSubjects(); updateExamSubjectDropdown(); hideAddSubjectForm();
    }

    /* â”€â”€ Render subjects â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function renderSubjects() {
      const grid   = document.getElementById('subjectsGrid');
      const addBtn = grid.querySelector('.add-subject-btn');
      grid.innerHTML = '';
      subjects.forEach(s => {
        const card = document.createElement('div'); card.className = 'subject-card';
        const img  = s.image || (s.defaultImage || (s.defaultImage = getRandomSubjectImage()));
        card.innerHTML = `
          <div class="subject-header">
            <img src="${img}" class="subject-image">
            <div class="subject-info" style="flex:1;">
              <h3>${s.name}</h3>
              <p><i class="fas fa-user-tie" style="font-size:.75rem;color:#38bdf8;margin-left:.25rem;"></i>Ø¯. ${s.doctor}</p>
              <p style="color:#38bdf8;font-size:.75rem;"><i class="fas fa-calendar-week" style="font-size:.7rem;margin-left:.25rem;"></i>${s.weeks.length} Ø£Ø³Ø¨ÙˆØ¹</p>
            </div>
            <button class="delete-btn" data-id="${s.id}"><i class="fas fa-trash-alt"></i></button>
          </div>`;
        card.querySelector('.delete-btn').addEventListener('click', ev => { ev.stopPropagation(); deleteSubject(s.id); });
        card.addEventListener('click', () => showSubjectDetail(s.id));
        grid.appendChild(card);
      });
      grid.appendChild(addBtn);
    }
    async function deleteSubject(id) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø§Ø¯Ø©ØŸ')) return;
      subjects = subjects.filter(s => s.id !== id);
      exams    = exams.filter(e => e.subjectId !== id);
      await saveData(); renderSubjects(); updateExamSubjectDropdown();
    }

    /* â”€â”€ Subject detail â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function showSubjectDetail(id) {
      currentSubject = subjects.find(s => s.id === id);
      document.getElementById('mainView').classList.add('hidden');
      const view = document.getElementById('subjectView');
      view.classList.remove('hidden');
      view.innerHTML = `
        <span class="back-btn" id="backToMainBtn">â† Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…ÙˆØ§Ø¯</span>
        <div style="display:flex;align-items:center;gap:1rem;margin-bottom:1.5rem;">
          ${currentSubject.image ? `<img src="${currentSubject.image}" style="width:80px;height:80px;border-radius:50%;object-fit:cover;border:3px solid rgba(56,189,248,0.4);box-shadow:0 0 16px rgba(56,189,248,0.2);">` : ''}
          <div><h2 style="font-size:1.5rem;margin-bottom:.25rem;color:#e2e8f0;">${currentSubject.name}</h2><p style="color:#64748b;">Ø¯. ${currentSubject.doctor}</p></div>
        </div>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem;margin-bottom:1.5rem;">
          <div class="upload-area" id="practicalExamArea">
            <h3 style="font-size:.875rem;margin-bottom:.5rem;color:#94a3b8;">ØµÙˆØ±Ø© Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠ</h3>
            <div id="practicalExamPreview">${currentSubject.practicalExam ? `<div class="upload-preview"><img src="${currentSubject.practicalExam}" style="max-width:100%;"><button class="delete-btn" id="deletePracticalBtn" style="position:absolute;top:.5rem;left:.5rem;">Ã—</button></div>` : 'ğŸ“¤'}</div>
            <input type="file" id="practicalExamInput" accept="image/*" class="hidden">
          </div>
          <div class="upload-area" id="oralExamArea">
            <h3 style="font-size:.875rem;margin-bottom:.5rem;color:#94a3b8;">ØµÙˆØ±Ø© Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ø´ÙÙˆÙŠ</h3>
            <div id="oralExamPreview">${currentSubject.oralExam ? `<div class="upload-preview"><img src="${currentSubject.oralExam}" style="max-width:100%;"><button class="delete-btn" id="deleteOralBtn" style="position:absolute;top:.5rem;left:.5rem;">Ã—</button></div>` : 'ğŸ“¤'}</div>
            <input type="file" id="oralExamInput" accept="image/*" class="hidden">
          </div>
        </div>
        <div style="margin-bottom:1.5rem;">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem;">
            <h3 style="color:#e2e8f0;">Ù…Ù„Ù Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¯ÙƒØªÙˆØ±</h3>
            ${currentSubject.doctorQuestions ? `<button class="btn btn-primary" style="padding:.4rem .8rem;font-size:.75rem;" id="addDoctorQuestionFileBtn">+ Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ù</button>` : ''}
          </div>
          <div class="upload-area" id="doctorQuestionsArea">
            <div id="doctorQuestionsPreview">${currentSubject.doctorQuestions
              ? `<div style="text-align:center;"><div style="color:#34d399;font-size:2rem;">âœ“</div><div class="file-name" style="margin-top:.5rem;">${currentSubject.doctorQuestionsName}</div><button class="file-open-btn" id="openDoctorQuestionsBtn">ÙØªØ­ Ø§Ù„Ù…Ù„Ù</button></div>`
              : 'ğŸ“¤ Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ Ù…Ù„Ù PDF'}</div>
            <input type="file" id="doctorQuestionsInput" accept=".pdf" class="hidden">
          </div>
          ${currentSubject.additionalDoctorFiles && currentSubject.additionalDoctorFiles.length
            ? `<div style="margin-top:1rem;display:grid;gap:.5rem;">${currentSubject.additionalDoctorFiles.map((f, i) =>
                `<div style="background:rgba(15,23,42,0.5);border:1px solid rgba(255,255,255,0.08);border-radius:.5rem;padding:.75rem;display:flex;align-items:center;justify-content:space-between;">
                   <div style="flex:1;display:flex;align-items:center;gap:.5rem;"><span style="color:#34d399;">ğŸ“„</span><span class="file-name" style="flex:1;">${f.name}</span></div>
                   <div style="display:flex;gap:.5rem;">
                     <button class="file-open-btn open-additional-file" data-file-idx="${i}" data-file-type="doctor">ÙØªØ­</button>
                     <button class="delete-btn delete-additional-file" data-file-idx="${i}" data-file-type="doctor" style="position:static;width:28px;height:28px;font-size:.9rem;">Ã—</button>
                   </div>
                 </div>`).join('')}</div>`
            : ''}
        </div>
        <div style="margin-bottom:1.5rem;">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem;">
            <h3 style="color:#e2e8f0;">Ø£Ø³Ø¦Ù„ØªÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</h3>
            <button class="btn btn-primary" id="captureQuestionBtn" style="padding:.5rem 1rem;">ğŸ“¸ Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© Ù„Ù„Ø³Ø¤Ø§Ù„</button>
          </div>
          <textarea class="textarea" id="myQuestions" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù„ÙŠ Ù…Ø´ ÙØ§Ù‡Ù…Ù‡Ø§...">${currentSubject.myQuestions}</textarea>
          <input type="file" id="questionImageInput" accept="image/*" capture="environment" class="hidden">
          <div id="questionImagesContainer" style="display:grid;grid-template-columns:repeat(2,1fr);gap:.5rem;margin-top:1rem;">
            ${currentSubject.questionImages ? currentSubject.questionImages.map((img, i) =>
              `<div style="position:relative;"><img src="${img}" style="width:100%;border-radius:.5rem;border:1px solid rgba(255,255,255,0.08);"><button class="delete-btn" data-img-index="${i}" style="position:absolute;top:.25rem;left:.25rem;">Ã—</button></div>`).join('') : ''}
          </div>
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
          <h3 style="color:#e2e8f0;">Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</h3>
          <div style="display:flex;gap:.5rem;">
            <button class="btn btn-primary" id="addWeekBtn">â• Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ø¨ÙˆØ¹</button>
            <button class="btn" style="background:rgba(6,40,20,0.5);color:#34d399;border:1px solid rgba(52,211,153,0.4);" id="saveChangesBtn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
          </div>
        </div>
        <div id="weeksList"></div>`;

      document.getElementById('backToMainBtn').addEventListener('click', backToMain);
      if (document.getElementById('deletePracticalBtn')) document.getElementById('deletePracticalBtn').addEventListener('click', e => { e.stopPropagation(); deleteExamImage('practical'); });
      if (document.getElementById('deleteOralBtn'))      document.getElementById('deleteOralBtn').addEventListener('click',      e => { e.stopPropagation(); deleteExamImage('oral'); });
      document.getElementById('practicalExamArea').addEventListener('click', () => document.getElementById('practicalExamInput').click());
      document.getElementById('oralExamArea').addEventListener('click',      () => document.getElementById('oralExamInput').click());
      document.getElementById('doctorQuestionsArea').addEventListener('click', () => document.getElementById('doctorQuestionsInput').click());
      if (document.getElementById('openDoctorQuestionsBtn'))
        document.getElementById('openDoctorQuestionsBtn').addEventListener('click', e => { e.stopPropagation(); openFile(currentSubject.doctorQuestions, currentSubject.doctorQuestionsName); });
      document.getElementById('practicalExamInput').addEventListener('change',  e => handleExamUpload(e, 'practical'));
      document.getElementById('oralExamInput').addEventListener('change',       e => handleExamUpload(e, 'oral'));
      document.getElementById('doctorQuestionsInput').addEventListener('change', handleDoctorQuestions);
      if (document.getElementById('addDoctorQuestionFileBtn'))
        document.getElementById('addDoctorQuestionFileBtn').addEventListener('click', e => { e.stopPropagation(); document.getElementById('doctorQuestionsInput').click(); });
      document.getElementById('myQuestions').addEventListener('input',       e => { currentSubject.myQuestions = e.target.value; });
      document.getElementById('captureQuestionBtn').addEventListener('click', () => document.getElementById('questionImageInput').click());
      document.getElementById('questionImageInput').addEventListener('change', handleQuestionImageUpload);
      document.getElementById('addWeekBtn').addEventListener('click',    addWeek);
      document.getElementById('saveChangesBtn').addEventListener('click', saveSubjectChanges);
      document.querySelectorAll('#questionImagesContainer .delete-btn').forEach(btn =>
        btn.addEventListener('click', function() { deleteQuestionImage(parseInt(this.dataset.imgIndex)); }));
      document.querySelectorAll('.open-additional-file[data-file-type="doctor"]').forEach(btn =>
        btn.addEventListener('click', e => { e.stopPropagation(); const f = currentSubject.additionalDoctorFiles[parseInt(btn.dataset.fileIdx)]; openFile(f.data, f.name); }));
      document.querySelectorAll('.delete-additional-file[data-file-type="doctor"]').forEach(btn =>
        btn.addEventListener('click', e => { e.stopPropagation(); deleteAdditionalDoctorFile(parseInt(btn.dataset.fileIdx)); }));
      renderWeeks();
    }

    /* â”€â”€ Exam images â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    async function handleExamUpload(e, type) {
      const file = e.target.files[0]; if (!file) return;
      const reader = new FileReader();
      reader.onload = async ev => {
        const c = await compressImage(ev.target.result, 700, 0.65);
        currentSubject[`${type}Exam`] = c; await saveData();
        const pid = type === 'practical' ? 'practicalExamPreview' : 'oralExamPreview';
        const bid = `delete${type === 'practical' ? 'Practical' : 'Oral'}Btn`;
        document.getElementById(pid).innerHTML =
          `<div class="upload-preview"><img src="${c}" style="max-width:100%;"><button class="delete-btn" id="${bid}" style="position:absolute;top:.5rem;left:.5rem;">Ã—</button></div>`;
        document.getElementById(bid).addEventListener('click', ev2 => { ev2.stopPropagation(); deleteExamImage(type); });
        showNotification('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© âœ“');
      };
      reader.readAsDataURL(file);
    }
    async function deleteExamImage(type) {
      currentSubject[`${type}Exam`] = null; await saveData();
      document.getElementById(type === 'practical' ? 'practicalExamPreview' : 'oralExamPreview').innerHTML = 'ğŸ“¤';
      showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø© âœ“');
    }

    /* â”€â”€ Doctor questions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    async function handleDoctorQuestions(e) {
      const file = e.target.files[0]; if (!file) return;
      const reader = new FileReader();
      reader.onload = async ev => {
        if (!currentSubject.doctorQuestions) {
          currentSubject.doctorQuestions = ev.target.result; currentSubject.doctorQuestionsName = file.name;
        } else {
          if (!currentSubject.additionalDoctorFiles) currentSubject.additionalDoctorFiles = [];
          currentSubject.additionalDoctorFiles.push({ name: file.name, data: ev.target.result });
        }
        await saveData(); showSubjectDetail(currentSubject.id); showNotification('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù âœ“');
      };
      reader.readAsDataURL(file);
    }
    async function deleteAdditionalDoctorFile(idx) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„ÙØŸ')) return;
      currentSubject.additionalDoctorFiles.splice(idx, 1); await saveData();
      showSubjectDetail(currentSubject.id); showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù âœ“');
    }

    /* â”€â”€ Weeks â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function addWeek() {
      currentSubject.weeks.push({
        id: Date.now(), number: currentSubject.weeks.length + 1,
        lectureSummary: null, lectureSummaryName: null,
        sectionSummary: null, sectionSummaryName: null,
        questions: null, questionsName: null, salawatCount: 0,
        lectureImages: [], sectionImages: [],
        additionalLectureFiles: [], additionalSectionFiles: [], additionalQuestionsFiles: [],
      });
      updateSubject(); renderWeeks();
    }

    function renderWeeks() {
      const list = document.getElementById('weeksList'); list.innerHTML = '';
      currentSubject.weeks.forEach(week => {
        const wc = document.createElement('div'); wc.className = 'week-card';

        const makeSlot = (label, fk, nk, inputId, at) => `
          <div style="position:relative;">
            <div class="file-upload" data-week="${week.id}" data-type="${fk}">
              <p style="font-size:.75rem;margin-bottom:.5rem;color:#94a3b8;">${label}</p>
              ${week[fk] ? `<div class="file-uploaded"><div style="color:#34d399;font-size:1.5rem;">âœ“</div><div class="file-name">${week[nk]}</div><button class="file-open-btn" data-file="${week[fk]}" data-name="${week[nk]}">ÙØªØ­</button></div>` : 'ğŸ“¤'}
              <input type="file" id="${inputId}_${week.id}" accept=".pdf" class="hidden">
            </div>
            ${week[fk] ? `<button class="btn btn-primary" style="position:absolute;top:-8px;left:-8px;padding:.3rem .5rem;font-size:.7rem;border-radius:.4rem;z-index:10;" data-add-file="${at}" data-wid="${week.id}">+</button>` : ''}
          </div>`;

        const makeAddFiles = (arr, type, color, icon) => arr && arr.length ? `
          <div style="margin-top:1rem;padding-top:1rem;border-top:1px solid rgba(255,255,255,0.06);">
            <h5 style="margin:0 0 .5rem 0;font-size:.8rem;color:#64748b;">Ù…Ù„ÙØ§Øª Ø¥Ø¶Ø§ÙÙŠØ© - ${type==='lecture'?'Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©':type==='section'?'Ù…Ù„Ø®Øµ Ø§Ù„Ø³ÙƒØ´Ù†':'Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©'}</h5>
            <div style="display:grid;gap:.5rem;">${arr.map((f, i) =>
              `<div style="background:rgba(15,23,42,0.5);border:1px solid rgba(255,255,255,0.06);border-radius:.5rem;padding:.5rem;display:flex;align-items:center;justify-content:space-between;">
                 <div style="flex:1;display:flex;align-items:center;gap:.5rem;"><span style="color:${color};">${icon}</span><span class="file-name" style="flex:1;font-size:.7rem;">${f.name}</span></div>
                 <div style="display:flex;gap:.25rem;"><button class="file-open-btn brv-open-add" data-wid="${week.id}" data-fidx="${i}" data-ftype="${type}">ÙØªØ­</button><button class="delete-btn brv-del-add" data-wid="${week.id}" data-fidx="${i}" data-ftype="${type}" style="position:static;width:22px;height:22px;font-size:.8rem;">Ã—</button></div>
               </div>`).join('')}</div>
          </div>` : '';

        wc.innerHTML = `
          <div class="week-header">
            <h4 style="color:#e2e8f0;">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${week.number}</h4>
            <span class="salawat-btn" data-week="${week.id}">ØµÙ„ÙÙ‘ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¨ÙŠ ï·º${week.salawatCount ? ` (${week.salawatCount})` : ''}</span>
          </div>
          <div class="week-files">
            ${makeSlot('Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©','lectureSummary','lectureSummaryName','lecture','lecture')}
            ${makeSlot('Ù…Ù„Ø®Øµ Ø§Ù„Ø³ÙƒØ´Ù†','sectionSummary','sectionSummaryName','section','section')}
            ${makeSlot('Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©','questions','questionsName','questions','questions')}
          </div>
          ${makeAddFiles(week.additionalLectureFiles,  'lecture',   '#a78bfa','ğŸ“„')}
          ${makeAddFiles(week.additionalSectionFiles,  'section',   '#fbbf24','ğŸ“„')}
          ${makeAddFiles(week.additionalQuestionsFiles,'questions', '#34d399','ğŸ“„')}
          <div style="margin-top:1rem;padding-top:1rem;border-top:1px solid rgba(255,255,255,0.06);">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem;">
              <h5 style="margin:0;font-size:.875rem;color:#e2e8f0;">ğŸ“¸ ØµÙˆØ± Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</h5>
              <button class="btn btn-primary" style="padding:.4rem .8rem;font-size:.75rem;" data-add-lecture-img="${week.id}">+ Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©</button>
            </div>
            <div id="lectureImages_${week.id}" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:.5rem;">
              ${week.lectureImages && week.lectureImages.length
                ? week.lectureImages.map((img, i) => `<div style="position:relative;border-radius:.5rem;overflow:hidden;border:1px solid rgba(56,189,248,0.2);"><img src="${img}" style="width:100%;height:100px;object-fit:cover;cursor:pointer;" onclick="viewWeekImage(${week.id},'lecture',${i})"><button class="delete-btn" style="position:absolute;top:.25rem;left:.25rem;width:24px;height:24px;font-size:.9rem;" data-delete-lecture-img="${week.id}" data-img-idx="${i}">Ã—</button></div>`).join('')
                : '<p style="text-align:center;color:#475569;font-size:.75rem;padding:1rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±</p>'}
            </div>
            <input type="file" id="lectureImageInput_${week.id}" accept="image/*" class="hidden" multiple>
          </div>
          <div style="margin-top:1rem;padding-top:1rem;border-top:1px solid rgba(255,255,255,0.06);">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem;">
              <h5 style="margin:0;font-size:.875rem;color:#e2e8f0;">ğŸ“¸ ØµÙˆØ± Ø§Ù„Ø³ÙƒØ´Ù†</h5>
              <button class="btn" style="background:rgba(40,20,0,0.5);color:#fbbf24;border:1px solid rgba(251,191,36,0.4);padding:.4rem .8rem;font-size:.75rem;border-radius:.5rem;" data-add-section-img="${week.id}">+ Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©</button>
            </div>
            <div id="sectionImages_${week.id}" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:.5rem;">
              ${week.sectionImages && week.sectionImages.length
                ? week.sectionImages.map((img, i) => `<div style="position:relative;border-radius:.5rem;overflow:hidden;border:1px solid rgba(251,191,36,0.2);"><img src="${img}" style="width:100%;height:100px;object-fit:cover;cursor:pointer;" onclick="viewWeekImage(${week.id},'section',${i})"><button class="delete-btn" style="position:absolute;top:.25rem;left:.25rem;width:24px;height:24px;font-size:.9rem;" data-delete-section-img="${week.id}" data-img-idx="${i}">Ã—</button></div>`).join('')
                : '<p style="text-align:center;color:#475569;font-size:.75rem;padding:1rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±</p>'}
            </div>
            <input type="file" id="sectionImageInput_${week.id}" accept="image/*" class="hidden" multiple>
          </div>`;

        list.appendChild(wc);
      });

      /* attach week events */
      document.querySelectorAll('.file-upload').forEach(el => el.addEventListener('click', function() {
        const wid = this.dataset.week, type = this.dataset.type;
        const inputId = type==='lectureSummary' ? `lecture_${wid}` : type==='sectionSummary' ? `section_${wid}` : `questions_${wid}`;
        document.getElementById(inputId).click();
      }));
      currentSubject.weeks.forEach(w => {
        ['lecture','section','questions'].forEach(t => {
          const el = document.getElementById(`${t}_${w.id}`);
          if (el) el.addEventListener('change', e => handleWeekFileUpload(e, w.id, t==='lecture'?'lectureSummary':t==='section'?'sectionSummary':'questions'));
        });
        const li = document.getElementById(`lectureImageInput_${w.id}`); if (li) li.addEventListener('change', e => handleWeekImagesUpload(e, w.id, 'lecture'));
        const si = document.getElementById(`sectionImageInput_${w.id}`); if (si) si.addEventListener('change', e => handleWeekImagesUpload(e, w.id, 'section'));
      });
      document.querySelectorAll('.file-open-btn[data-file]').forEach(btn =>
        btn.addEventListener('click', e => { e.stopPropagation(); openFile(btn.dataset.file, btn.dataset.name); }));
      document.querySelectorAll('.salawat-btn').forEach(btn =>
        btn.addEventListener('click', function() { incrementSalawat(parseInt(this.dataset.week)); }));
      document.querySelectorAll('[data-add-lecture-img]').forEach(btn =>
        btn.addEventListener('click', e => { e.stopPropagation(); document.getElementById(`lectureImageInput_${btn.dataset.addLectureImg}`).click(); }));
      document.querySelectorAll('[data-add-section-img]').forEach(btn =>
        btn.addEventListener('click', e => { e.stopPropagation(); document.getElementById(`sectionImageInput_${btn.dataset.addSectionImg}`).click(); }));
      document.querySelectorAll('[data-delete-lecture-img]').forEach(btn =>
        btn.addEventListener('click', e => { e.stopPropagation(); deleteWeekImage(parseInt(btn.dataset.deleteLectureImg),'lecture',parseInt(btn.dataset.imgIdx)); }));
      document.querySelectorAll('[data-delete-section-img]').forEach(btn =>
        btn.addEventListener('click', e => { e.stopPropagation(); deleteWeekImage(parseInt(btn.dataset.deleteSectionImg),'section',parseInt(btn.dataset.imgIdx)); }));
      document.querySelectorAll('[data-add-file]').forEach(btn =>
        btn.addEventListener('click', e => { e.stopPropagation(); addAdditionalFile(parseInt(btn.dataset.wid), btn.dataset.addFile); }));
      document.querySelectorAll('.brv-open-add').forEach(btn =>
        btn.addEventListener('click', e => { e.stopPropagation(); const w=currentSubject.weeks.find(x=>x.id===parseInt(btn.dataset.wid)); const arr=btn.dataset.ftype==='lecture'?w.additionalLectureFiles:btn.dataset.ftype==='section'?w.additionalSectionFiles:w.additionalQuestionsFiles; const f=arr[parseInt(btn.dataset.fidx)]; if(f) openFile(f.data,f.name); }));
      document.querySelectorAll('.brv-del-add').forEach(btn =>
        btn.addEventListener('click', e => { e.stopPropagation(); deleteAdditionalWeekFile(parseInt(btn.dataset.wid),btn.dataset.ftype,parseInt(btn.dataset.fidx)); }));
    }

    function addAdditionalFile(weekId, type) {
      const input = document.createElement('input'); input.type = 'file'; input.accept = '.pdf';
      input.onchange = async e => {
        const file = e.target.files[0]; if (!file) return;
        const reader = new FileReader();
        reader.onload = async ev => {
          const week = currentSubject.weeks.find(w => w.id === weekId);
          const key  = type==='lecture' ? 'additionalLectureFiles' : type==='section' ? 'additionalSectionFiles' : 'additionalQuestionsFiles';
          if (!week[key]) week[key] = [];
          week[key].push({ name: file.name, data: ev.target.result });
          await saveData(); showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„Ù âœ“'); showSubjectDetail(currentSubject.id);
        };
        reader.readAsDataURL(file);
      };
      input.click();
    }
    async function deleteAdditionalWeekFile(weekId, type, idx) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„ÙØŸ')) return;
      const week = currentSubject.weeks.find(w => w.id === weekId);
      const key  = type==='lecture' ? 'additionalLectureFiles' : type==='section' ? 'additionalSectionFiles' : 'additionalQuestionsFiles';
      week[key].splice(idx, 1); await saveData(); renderWeeks(); showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù âœ“');
    }
    async function incrementSalawat(weekId) {
      const week = currentSubject.weeks.find(w => w.id === weekId);
      if (!week.salawatCount) week.salawatCount = 0; week.salawatCount++;
      await saveData();
      const btn = document.querySelector(`.salawat-btn[data-week="${weekId}"]`);
      btn.textContent = `ØµÙ„ÙÙ‘ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¨ÙŠ ï·º (${week.salawatCount})`;
      btn.style.transform = 'scale(1.2)'; btn.style.textShadow = '0 0 12px rgba(52,211,153,1)';
      setTimeout(() => { btn.style.transform = 'scale(1)'; btn.style.textShadow = ''; }, 200);
    }
    async function handleQuestionImageUpload(e) {
      const file = e.target.files[0]; if (!file) return;
      const reader = new FileReader();
      reader.onload = async ev => {
        const c = await compressImage(ev.target.result, 700, 0.6);
        if (!currentSubject.questionImages) currentSubject.questionImages = [];
        currentSubject.questionImages.push(c); await saveData();
        const container = document.getElementById('questionImagesContainer');
        const div = document.createElement('div'); div.style.position = 'relative';
        div.innerHTML = `<img src="${c}" style="width:100%;border-radius:.5rem;border:1px solid rgba(255,255,255,0.08);"><button class="delete-btn" data-img-index="${currentSubject.questionImages.length-1}" style="position:absolute;top:.25rem;left:.25rem;">Ã—</button>`;
        div.querySelector('.delete-btn').addEventListener('click', function() { deleteQuestionImage(parseInt(this.dataset.imgIndex)); });
        container.appendChild(div); showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ âœ“');
      };
      reader.readAsDataURL(file);
    }
    async function deleteQuestionImage(idx) {
      currentSubject.questionImages.splice(idx, 1); await saveData();
      const c = document.getElementById('questionImagesContainer');
      c.innerHTML = currentSubject.questionImages.map((img, i) =>
        `<div style="position:relative;"><img src="${img}" style="width:100%;border-radius:.5rem;border:1px solid rgba(255,255,255,0.08);"><button class="delete-btn" data-img-index="${i}" style="position:absolute;top:.25rem;left:.25rem;">Ã—</button></div>`).join('');
      c.querySelectorAll('.delete-btn').forEach(btn => btn.addEventListener('click', function() { deleteQuestionImage(parseInt(this.dataset.imgIndex)); }));
      showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø© âœ“');
    }
    async function handleWeekImagesUpload(e, weekId, type) {
      const files = e.target.files; if (!files || !files.length) return;
      const week  = currentSubject.weeks.find(w => w.id === weekId);
      const key   = type === 'lecture' ? 'lectureImages' : 'sectionImages';
      if (!week[key]) week[key] = []; showNotification('Ø¬Ø§Ø±ÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙˆØ±...');
      for (const file of files) {
        const reader = new FileReader();
        await new Promise(res => { reader.onload = async ev => { week[key].push(await compressImage(ev.target.result, 700, 0.6)); res(); }; reader.readAsDataURL(file); });
      }
      await saveData(); renderWeeks();
    }
    async function deleteWeekImage(weekId, type, idx) {
      const week = currentSubject.weeks.find(w => w.id === weekId);
      const key  = type === 'lecture' ? 'lectureImages' : 'sectionImages';
      if (week && week[key]) { week[key].splice(idx, 1); await saveData(); renderWeeks(); showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø© âœ“'); }
    }
    function viewWeekImage(weekId, type, idx) {
      const week = currentSubject.weeks.find(w => w.id === weekId);
      const key  = type === 'lecture' ? 'lectureImages' : 'sectionImages';
      if (!week || !week[key] || !week[key][idx]) return;
      brvCurrentFile = { data: week[key][idx], name: `ØµÙˆØ±Ø©_${type}_${idx+1}.jpg` };
      showBRVModal(brvCurrentFile.name); brvShowImage(week[key][idx]);
    }
    async function saveSubjectChanges() { await saveData(); showNotification('ØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª âœ“', 2000); }
    async function handleWeekFileUpload(e, weekId, type) {
      const file = e.target.files[0]; if (!file) return;
      const reader = new FileReader();
      reader.onload = async ev => {
        const week = currentSubject.weeks.find(w => w.id === weekId);
        week[type] = ev.target.result; week[type + 'Name'] = file.name;
        await saveData(); renderWeeks(); showNotification('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù âœ“');
      };
      reader.readAsDataURL(file);
    }
    function updateSubject() { const i = subjects.findIndex(s => s.id === currentSubject.id); if (i !== -1) { subjects[i] = currentSubject; saveData(); } }
    function backToMain() { document.getElementById('subjectView').classList.add('hidden'); document.getElementById('mainView').classList.remove('hidden'); currentSubject = null; }

    /* â”€â”€ Exams â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function updateExamSubjectDropdown() {
      const dd = document.getElementById('examSubject');
      dd.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option>';
      subjects.forEach(s => { const o = document.createElement('option'); o.value = s.id; o.textContent = s.name; dd.appendChild(o); });
    }
    function hideAddExamForm() {
      document.getElementById('addExamForm').classList.add('hidden');
      ['examSubject','examType','examDate','examTime'].forEach(id => { const el = document.getElementById(id); if(el) el.value = id==='examType'?'mid':''; });
    }
    async function addExamToSchedule() {
      const subjectId = parseInt(document.getElementById('examSubject').value);
      const type      = document.getElementById('examType').value;
      const date      = document.getElementById('examDate').value;
      const time      = document.getElementById('examTime').value;
      if (!subjectId || !date || !time) { alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'); return; }
      const subject = subjects.find(s => s.id === subjectId);
      exams.push({ id: Date.now(), subjectId, subjectName: subject.name, type, date, time, examImage: null, examImageName: null });
      await saveData(); renderExamSchedule(); hideAddExamForm();
    }
    function renderExamSchedule() {
      const tbody = document.getElementById('examTableBody');
      if (!exams.length) { tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;color:#475569;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©</td></tr>'; return; }
      tbody.innerHTML = '';
      [...exams].sort((a, b) => new Date(a.date) - new Date(b.date)).forEach(exam => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${exam.subjectName}</td>
          <td><span class="exam-type-badge ${exam.type==='mid'?'badge-mid':'badge-final'}">${exam.type==='mid'?'Ù…ÙŠØ¯ ØªÙŠØ±Ù…':'ÙØ§ÙŠÙ†Ø§Ù„'}</span></td>
          <td>${exam.date}</td><td>${exam.time}</td>
          <td>${exam.examImage
            ? `<button class="btn btn-primary" style="padding:.5rem 1rem;font-size:.875rem;" data-view-exam="${exam.id}">ğŸ‘ï¸ Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø©</button>`
            : `<button class="add-exam-btn"  style="padding:.5rem 1rem;font-size:.875rem;" data-upload-exam="${exam.id}">ğŸ“¤ Ø±ÙØ¹ ØµÙˆØ±Ø©</button>`}</td>
          <td><button class="btn-danger" style="padding:.5rem 1rem;border-radius:.5rem;border:none;cursor:pointer;font-weight:600;" data-exam-id="${exam.id}">Ø­Ø°Ù</button></td>`;
        tbody.appendChild(tr);
      });
      document.querySelectorAll('[data-exam-id]').forEach(btn =>     btn.addEventListener('click', function() { deleteExam(parseInt(this.dataset.examId)); }));
      document.querySelectorAll('[data-upload-exam]').forEach(btn => btn.addEventListener('click', function() { uploadExamImage(parseInt(this.dataset.uploadExam)); }));
      document.querySelectorAll('[data-view-exam]').forEach(btn =>   btn.addEventListener('click', function() { viewExamImage(parseInt(this.dataset.viewExam)); }));
    }
    async function deleteExam(id) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†ØŸ')) return;
      exams = exams.filter(e => e.id !== id); await saveData(); renderExamSchedule(); showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† âœ“');
    }
    function uploadExamImage(examId) {
      const input = document.createElement('input'); input.type = 'file'; input.accept = 'image/*';
      input.onchange = async e => {
        const file = e.target.files[0]; if (!file) return;
        const reader = new FileReader();
        reader.onload = async ev => {
          const c = await compressImage(ev.target.result, 700, 0.65);
          const exam = exams.find(ex => ex.id === examId); exam.examImage = c; exam.examImageName = file.name;
          await saveData(); renderExamSchedule(); showNotification('ØªÙ… Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† âœ“');
        };
        reader.readAsDataURL(file);
      };
      input.click();
    }
    function viewExamImage(examId) {
      const exam = exams.find(ex => ex.id === examId); if (!exam || !exam.examImage) return;
      brvCurrentFile = { data: exam.examImage, name: exam.examImageName || 'exam-image.jpg' };
      showBRVModal(brvCurrentFile.name); brvShowImage(exam.examImage);
    }
    async function handleScheduleImageUpload(e, type) {
      const file = e.target.files[0]; if (!file) return;
      const reader = new FileReader();
      reader.onload = async ev => {
        examScheduleImages[type] = await compressImage(ev.target.result, 900, 0.7);
        await saveData(); renderScheduleImages(); showNotification('ØªÙ… Ø­ÙØ¸ ØµÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ âœ“');
      };
      reader.readAsDataURL(file);
    }
    function renderScheduleImages() {
      ['mid','final'].forEach(type => {
        const p = document.getElementById(`${type}ExamSchedulePreview`);
        p.innerHTML = examScheduleImages[type]
          ? `<div style="position:relative;"><img src="${examScheduleImages[type]}" style="max-width:100%;border-radius:.5rem;cursor:pointer;border:1px solid rgba(56,189,248,0.15);" onclick="viewScheduleImage('${type}')"><button class="delete-btn" onclick="deleteScheduleImage('${type}')" style="position:absolute;top:.5rem;left:.5rem;">Ã—</button></div>`
          : `ğŸ“¤ Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¬Ø¯ÙˆÙ„ ${type==='mid'?'Ø§Ù„Ù…ÙŠØ¯ ØªÙŠØ±Ù…':'Ø§Ù„ÙØ§ÙŠÙ†Ø§Ù„'}`;
      });
    }
    function viewScheduleImage(type) {
      if (!examScheduleImages[type]) return;
      brvCurrentFile = { data: examScheduleImages[type], name: `schedule-${type}.jpg` };
      showBRVModal(brvCurrentFile.name); brvShowImage(examScheduleImages[type]);
    }
    function deleteScheduleImage(type) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ØµÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ØŸ')) return;
      examScheduleImages[type] = null; saveData(); renderScheduleImages(); showNotification('ØªÙ… Ø­Ø°Ù ØµÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ âœ“');
    }

    /* â”€â”€ Online Lectures â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function openOnlineLectures() {
      if ('Notification' in window && Notification.permission === 'default') { showNotificationPermissionDialog(); return; }
      if ('Notification' in window && Notification.permission === 'granted') notificationPermission = true;
      renderOnlineLecturesModal();
    }
    function showNotificationPermissionDialog() {
      const d = document.createElement('div');
      d.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.85);z-index:20000;display:flex;align-items:center;justify-content:center;padding:1rem;backdrop-filter:blur(8px);';
      d.innerHTML = `<div style="background:rgba(15,23,42,0.95);border:1px solid rgba(56,189,248,0.2);border-radius:1rem;padding:2rem;max-width:450px;width:100%;box-shadow:0 0 40px rgba(56,189,248,0.1);">
        <div style="text-align:center;margin-bottom:1.5rem;"><div style="font-size:4rem;margin-bottom:1rem;">ğŸ””</div><h3 style="margin:0 0 .5rem 0;color:#e2e8f0;">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3><p style="margin:0;color:#64748b;line-height:1.6;">Ù†ÙˆØ¯ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„ØªØ°ÙƒÙŠØ±Ùƒ Ø¨Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</p></div>
        <div style="display:grid;gap:.75rem;">
          <button id="allowNotifications" style="background:rgba(6,40,20,0.6);color:#34d399;border:1px solid rgba(52,211,153,0.4);padding:1rem;border-radius:.75rem;cursor:pointer;font-weight:600;font-size:1rem;">âœ“ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</button>
          <button id="denyNotifications" style="background:rgba(30,41,59,0.6);color:#64748b;border:1px solid rgba(255,255,255,0.1);padding:1rem;border-radius:.75rem;cursor:pointer;font-weight:600;font-size:1rem;">Ã— Ø±ÙØ¶</button>
        </div></div>`;
      document.body.appendChild(d);
      document.getElementById('allowNotifications').onclick = async () => {
        const p = await Notification.requestPermission(); notificationPermission = p === 'granted'; d.remove();
        if (notificationPermission) showNotification('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª âœ“', 2000); renderOnlineLecturesModal();
      };
      document.getElementById('denyNotifications').onclick = () => { d.remove(); renderOnlineLecturesModal(); };
    }
    function renderOnlineLecturesModal() {
      const modal = document.createElement('div');
      modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.85);z-index:10000;display:flex;flex-direction:column;padding:1rem;overflow-y:auto;backdrop-filter:blur(8px);';
      modal.innerHTML = `<div style="background:rgba(15,23,42,0.95);border:1px solid rgba(56,189,248,0.15);border-radius:1rem;padding:2rem;max-width:1000px;margin:auto;width:100%;box-shadow:0 0 60px rgba(56,189,248,0.08);">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;">
          <h2 style="margin:0;color:#e2e8f0;">ğŸ• Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</h2>
          <button onclick="this.closest('[style*=fixed]').remove()" style="background:rgba(80,10,10,0.5);color:#fca5a5;border:1px solid rgba(239,68,68,0.4);border-radius:.5rem;padding:.75rem 1.5rem;cursor:pointer;font-weight:600;">âœ• Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
        <div style="background:rgba(15,23,42,0.5);border:1px solid rgba(56,189,248,0.1);border-radius:.75rem;padding:1.5rem;margin-bottom:1.5rem;">
          <h3 style="margin-bottom:1rem;color:#e2e8f0;">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ø§Ø¶Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
          <div style="display:grid;gap:1rem;">
            <select id="lectureSubject" class="input"><option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option>${subjects.map(s=>`<option value="${s.id}">${s.name}</option>`).join('')}</select>
            <input type="text"  id="lectureTitle" class="input" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
            <input type="date"  id="lectureDate"  class="input">
            <input type="time"  id="lectureTime"  class="input">
            <input type="url"   id="lectureLink"  class="input" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©">
            <div style="background:rgba(15,23,42,0.5);border:1px solid rgba(255,255,255,0.06);border-radius:.5rem;padding:1rem;">
              <h4 style="margin:0 0 .75rem 0;font-size:.875rem;color:#94a3b8;">â° Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h4>
              <div style="display:grid;gap:.75rem;">
                <div style="display:flex;align-items:center;gap:.5rem;"><label style="font-size:.875rem;color:#64748b;">Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª:</label><input type="number" id="notificationCount" class="input" min="1" max="10" value="3" style="width:80px;padding:.5rem;"></div>
                <div style="display:flex;align-items:center;gap:.5rem;"><label style="font-size:.875rem;color:#64748b;">Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† ÙƒÙ„ Ø¥Ø´Ø¹Ø§Ø± (Ø¯Ù‚Ø§Ø¦Ù‚):</label><input type="number" id="notificationInterval" class="input" min="5" max="120" value="15" style="width:80px;padding:.5rem;"></div>
              </div>
            </div>
            <button onclick="addOnlineLecture()" class="btn btn-primary" style="font-size:1rem;padding:.875rem;">Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</button>
          </div>
        </div>
        <div id="lecturesList">${renderLecturesList()}</div>
      </div>`;
      document.body.appendChild(modal);
    }
    function renderLecturesList() {
      if (!onlineLectures.length) return '<p style="text-align:center;color:#475569;padding:2rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©</p>';
      return [...onlineLectures].sort((a,b)=>new Date(a.date+' '+a.time)-new Date(b.date+' '+b.time)).map(l => {
        const subject = subjects.find(s => s.id === l.subjectId);
        const isPast  = new Date(l.date+' '+l.time) < new Date();
        return `<div style="background:${isPast?'rgba(15,23,42,0.3)':'rgba(14,50,80,0.25)'};border:1px solid ${isPast?'rgba(255,255,255,0.06)':'rgba(56,189,248,0.15)'};border-radius:.75rem;padding:1.5rem;margin-bottom:1rem;${isPast?'opacity:.6;':''}">
          <div style="display:flex;justify-content:space-between;align-items:start;">
            <div style="flex:1;">
              <h4 style="margin:0 0 .5rem 0;color:#e2e8f0;">${l.title||'Ù…Ø­Ø§Ø¶Ø±Ø©'}</h4>
              <p style="margin:0;color:#64748b;font-size:.875rem;">ğŸ“š ${subject?subject.name:'Ù…Ø§Ø¯Ø© Ù…Ø­Ø°ÙˆÙØ©'}</p>
              <p style="margin:.25rem 0 0 0;color:#64748b;font-size:.875rem;">ğŸ“… ${l.date} â€¢ â° ${l.time}</p>
              ${l.link ? `<a href="${l.link}" target="_blank" style="color:#38bdf8;font-size:.875rem;text-decoration:none;display:inline-block;margin-top:.5rem;">ğŸ”— ÙØªØ­ Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</a>` : ''}
              <p style="margin:.5rem 0 0 0;color:#a78bfa;font-size:.75rem;">ğŸ”” ${l.notificationCount} Ø¥Ø´Ø¹Ø§Ø± ÙƒÙ„ ${l.notificationInterval} Ø¯Ù‚ÙŠÙ‚Ø©</p>
            </div>
            <button onclick="deleteOnlineLecture(${l.id})" style="background:rgba(80,10,10,0.5);color:#fca5a5;border:1px solid rgba(239,68,68,0.3);border-radius:.5rem;padding:.5rem 1rem;cursor:pointer;font-size:.875rem;">ğŸ—‘ï¸</button>
          </div>
        </div>`;
      }).join('');
    }
    function addOnlineLecture() {
      const subjectId = parseInt(document.getElementById('lectureSubject').value);
      const title     = document.getElementById('lectureTitle').value;
      const date      = document.getElementById('lectureDate').value;
      const time      = document.getElementById('lectureTime').value;
      const link      = document.getElementById('lectureLink').value;
      const nc = parseInt(document.getElementById('notificationCount').value);
      const ni = parseInt(document.getElementById('notificationInterval').value);
      if (!subjectId || !date || !time) { alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ù…Ù„Ø£ Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„'); return; }
      onlineLectures.push({ id: Date.now(), subjectId, title, date, time, link, notificationCount: nc, notificationInterval: ni, notificationsSent: [] });
      saveData();
      const ll = document.getElementById('lecturesList'); if (ll) ll.innerHTML = renderLecturesList();
      ['lectureSubject','lectureTitle','lectureDate','lectureTime','lectureLink'].forEach(id => { document.getElementById(id).value = ''; });
      document.getElementById('notificationCount').value  = '3';
      document.getElementById('notificationInterval').value = '15';
      showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© âœ“');
    }
    function deleteOnlineLecture(id) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©ØŸ')) return;
      onlineLectures = onlineLectures.filter(l => l.id !== id); saveData();
      const ll = document.getElementById('lecturesList'); if (ll) ll.innerHTML = renderLecturesList();
      showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© âœ“');
    }
    function checkUpcomingLectures() {
      if (!notificationPermission || !onlineLectures.length) return;
      const now = new Date();
      onlineLectures.forEach(l => {
        if (!l.notificationsSent) l.notificationsSent = [];
        const ldt = new Date(l.date + ' ' + l.time);
        for (let i = 0; i < l.notificationCount; i++) {
          const nt = new Date(ldt.getTime() - i * l.notificationInterval * 60000), key = `${i}`;
          if (nt - now > 0 && nt - now <= 60000 && !l.notificationsSent.includes(key)) {
            const subject = subjects.find(s => s.id === l.subjectId);
            const n = new Notification('ØªØ°ÙƒÙŠØ±: Ù…Ø­Ø§Ø¶Ø±Ø© Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†', {
              body: `${l.title||'Ù…Ø­Ø§Ø¶Ø±Ø©'} - ${subject?subject.name:'Ù…Ø§Ø¯Ø©'}\nØªØ¨Ø¯Ø£ Ø¨Ø¹Ø¯ ${i*l.notificationInterval} Ø¯Ù‚ÙŠÙ‚Ø©`,
              tag: `lecture-${l.id}-${i}`, requireInteraction: true,
            });
            if (l.link) n.onclick = function() { window.open(l.link, '_blank'); this.close(); };
            l.notificationsSent.push(key); saveData();
          }
        }
      });
    }

    /* â”€â”€ Export / Import â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    async function exportAllData() {
      const btn = document.getElementById('exportDataBtn'), orig = btn.innerHTML;
      btn.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±...'; btn.disabled = true;
      try {
        const blob = new Blob([JSON.stringify({ version:'1.0', exportDate: new Date().toISOString(), subjects, exams, examScheduleImages, onlineLectures }, null, 2)], { type: 'application/json' });
        const url  = URL.createObjectURL(blob), now = new Date();
        const a = document.createElement('a'); a.href = url;
        a.download = `study-organizer-backup-${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}.json`;
        document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
        btn.innerHTML = 'âœ“ ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±!'; btn.style.color = '#34d399';
        setTimeout(() => { btn.innerHTML = orig; btn.style.color = ''; btn.disabled = false; }, 2000);
        showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœ“', 2500);
      } catch { btn.innerHTML = orig; btn.disabled = false; alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµØ¯ÙŠØ±.'); }
    }
    async function importAllData(e) {
      const file = e.target.files[0]; if (!file) return;
      const btn  = document.getElementById('importDataBtn'), orig = btn.innerHTML;
      btn.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯...'; btn.disabled = true;
      const reader = new FileReader();
      reader.onload = async ev => {
        try {
          const data = JSON.parse(ev.target.result);
          if (!data.version || !data.subjects) throw new Error('Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­');
          if (!confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©ØŸ\nğŸ“š Ø§Ù„Ù…ÙˆØ§Ø¯: ${data.subjects.length}\nğŸ“ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª: ${data.exams?.length||0}\nğŸ• Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª: ${data.onlineLectures?.length||0}\nâš ï¸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©.`)) { btn.innerHTML = orig; btn.disabled = false; return; }
          subjects = data.subjects || []; exams = data.exams || []; examScheduleImages = data.examScheduleImages || { mid: null, final: null }; onlineLectures = data.onlineLectures || [];
          await saveData(); renderSubjects(); updateExamSubjectDropdown();
          btn.innerHTML = 'âœ“ ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯!'; btn.style.color = '#34d399';
          setTimeout(() => { btn.innerHTML = orig; btn.style.color = ''; btn.disabled = false; }, 2000);
          showNotification('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœ“', 2500);
        } catch { alert('Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø®ØªØ§Ø± ØºÙŠØ± ØµØ§Ù„Ø­.'); btn.innerHTML = orig; btn.disabled = false; }
        document.getElementById('importFileInput').value = '';
      };
      reader.readAsText(file);
    }

    /* â”€â”€ Search â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function handleSearch(e) {
      const term = e.target.value.toLowerCase().trim();
      const rc   = document.getElementById('searchResultsContent');
      if (!term) { rc.innerHTML = '<h3 style="margin-bottom:1rem;color:#64748b;">Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…ÙÙŠØ¯Ø© Ù„Ù„Ø¨Ø­Ø«:</h3>'; return; }
      const results = [];
      subjects.forEach(s => {
        if (s.name.toLowerCase().includes(term) || s.doctor.toLowerCase().includes(term))
          results.push({ type:'subject', title:s.name, desc:`Ø¯. ${s.doctor}`, action:()=>{switchTab('subjects');setTimeout(()=>showSubjectDetail(s.id),100);} });
        s.weeks.forEach(w => {
          [{key:'lectureSummaryName',label:'Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©'},{key:'sectionSummaryName',label:'Ù…Ù„Ø®Øµ Ø§Ù„Ø³ÙƒØ´Ù†'},{key:'questionsName',label:'Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©'}].forEach(f => {
            if (w[f.key] && w[f.key].toLowerCase().includes(term))
              results.push({ type:'file', title:w[f.key], desc:`${s.name} - Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${w.number} - ${f.label}`, action:()=>{switchTab('subjects');setTimeout(()=>showSubjectDetail(s.id),100);} });
          });
        });
        if (s.doctorQuestionsName && s.doctorQuestionsName.toLowerCase().includes(term))
          results.push({ type:'file', title:s.doctorQuestionsName, desc:`${s.name} - Ù…Ù„Ù Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¯ÙƒØªÙˆØ±`, action:()=>{switchTab('subjects');setTimeout(()=>showSubjectDetail(s.id),100);} });
      });
      exams.forEach(ex => {
        if (ex.subjectName.toLowerCase().includes(term)||(ex.type==='mid'&&'Ù…ÙŠØ¯ ØªÙŠØ±Ù…'.includes(term))||(ex.type==='final'&&'ÙØ§ÙŠÙ†Ø§Ù„'.includes(term)))
          results.push({ type:'exam', title:`Ø§Ù…ØªØ­Ø§Ù† ${ex.type==='mid'?'Ù…ÙŠØ¯ ØªÙŠØ±Ù…':'ÙØ§ÙŠÙ†Ø§Ù„'}`, desc:`${ex.subjectName} - ${ex.date} ${ex.time}`, action:()=>switchTab('exams') });
      });
      if (!results.length) {
        rc.innerHTML = `<div style="text-align:center;padding:3rem;background:rgba(15,23,42,0.4);border:1px dashed rgba(255,255,255,0.08);border-radius:1rem;"><div style="font-size:4rem;margin-bottom:1rem;">ğŸ”</div><h3 style="color:#64748b;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</h3><p style="color:#475569;">Ø¬Ø±Ø¨ Ø§Ù„Ø¨Ø­Ø« Ø¨ÙƒÙ„Ù…Ø§Øª Ø£Ø®Ø±Ù‰</p></div>`;
        return;
      }
      rc.innerHTML = `<h3 style="margin-bottom:1rem;color:#e2e8f0;">ğŸ” Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« (${results.length})</h3><div id="srGrid" style="display:grid;gap:1rem;"></div>`;
      const grid = document.getElementById('srGrid');
      results.forEach(r => {
        const card = document.createElement('div'); card.className = 'research-card'; card.style.cursor = 'pointer';
        card.innerHTML = `<div style="display:flex;align-items:center;gap:1rem;"><div style="font-size:2rem;">${r.type==='subject'?'ğŸ“š':r.type==='file'?'ğŸ“„':'ğŸ“'}</div><div style="flex:1;"><h4 style="margin:0 0 .25rem 0;color:#e2e8f0;">${r.title}</h4><p style="margin:0;color:#64748b;font-size:.875rem;">${r.desc}</p></div><div style="color:#38bdf8;font-size:1.5rem;">â†’</div></div>`;
        card.addEventListener('click', r.action); grid.appendChild(card);
      });
    }

    /* â”€â”€ Text Converter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function openTextConverter() {
      const modal = document.createElement('div');
      modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.85);z-index:10000;display:flex;flex-direction:column;padding:1rem;overflow-y:auto;backdrop-filter:blur(8px);';
      modal.innerHTML = `<div style="background:rgba(15,23,42,0.95);border:1px solid rgba(56,189,248,0.15);border-radius:1rem;padding:2rem;max-width:1200px;margin:auto;width:100%;box-shadow:0 0 60px rgba(56,189,248,0.08);">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;">
          <h2 style="margin:0;color:#e2e8f0;">âœï¸ Ù…Ø­ÙˆÙ„ Ø§Ù„Ù†ØµÙˆØµ ÙˆØ§Ù„Ø£Ø³Ø¦Ù„Ø©</h2>
          <button onclick="this.closest('[style*=fixed]').remove()" style="background:rgba(80,10,10,0.5);color:#fca5a5;border:1px solid rgba(239,68,68,0.4);border-radius:.5rem;padding:.75rem 1.5rem;cursor:pointer;font-weight:600;">âœ• Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
        <div style="margin-bottom:1.5rem;"><label style="display:block;margin-bottom:.5rem;font-weight:600;color:#94a3b8;">ğŸ“‹ Ø§Ù„ØµÙ‚ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§:</label><textarea id="textInput" style="width:100%;min-height:150px;padding:1rem;border:1px solid rgba(255,255,255,0.1);border-radius:.75rem;font-family:inherit;font-size:1rem;resize:vertical;background:rgba(15,23,42,0.6);color:#e2e8f0;" placeholder="Ø§Ù„ØµÙ‚ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§..."></textarea></div>
        <div style="margin-bottom:1.5rem;"><label style="display:block;margin-bottom:.5rem;font-weight:600;color:#94a3b8;">ğŸ¨ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­Ø±ÙŠØ±:</label>
          <div style="display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:1rem;">
            <button onclick="formatText('bold')"      class="btn btn-primary" style="padding:.5rem 1rem;font-weight:900;">B</button>
            <button onclick="formatText('italic')"    class="btn btn-primary" style="padding:.5rem 1rem;font-style:italic;">I</button>
            <button onclick="formatText('underline')" class="btn btn-primary" style="padding:.5rem 1rem;text-decoration:underline;">U</button>
            <button onclick="highlightText('yellow')" style="background:rgba(254,240,138,0.15);color:#fef08a;border:1px solid rgba(254,240,138,0.3);padding:.5rem 1rem;border-radius:.5rem;cursor:pointer;font-weight:600;">ğŸŸ¨ Ø£ØµÙØ±</button>
            <button onclick="highlightText('green')"  style="background:rgba(187,247,208,0.1);color:#86efac;border:1px solid rgba(134,239,172,0.3);padding:.5rem 1rem;border-radius:.5rem;cursor:pointer;font-weight:600;">ğŸŸ© Ø£Ø®Ø¶Ø±</button>
            <button onclick="highlightText('blue')"   style="background:rgba(147,197,253,0.1);color:#93c5fd;border:1px solid rgba(147,197,253,0.3);padding:.5rem 1rem;border-radius:.5rem;cursor:pointer;font-weight:600;">ğŸŸ¦ Ø£Ø²Ø±Ù‚</button>
            <button onclick="highlightText('pink')"   style="background:rgba(249,168,212,0.1);color:#f9a8d4;border:1px solid rgba(249,168,212,0.3);padding:.5rem 1rem;border-radius:.5rem;cursor:pointer;font-weight:600;">ğŸŸª ÙˆØ±Ø¯ÙŠ</button>
            <button onclick="increaseFontSize()" style="background:rgba(30,41,59,0.6);color:#94a3b8;border:1px solid rgba(255,255,255,0.1);padding:.5rem 1rem;border-radius:.5rem;cursor:pointer;font-weight:600;">A+</button>
            <button onclick="decreaseFontSize()" style="background:rgba(30,41,59,0.6);color:#94a3b8;border:1px solid rgba(255,255,255,0.1);padding:.5rem 1rem;border-radius:.5rem;cursor:pointer;font-weight:600;">A-</button>
          </div></div>
        <div style="margin-bottom:1.5rem;"><label style="display:block;margin-bottom:.5rem;font-weight:600;color:#94a3b8;">ğŸ“ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø­Ø±Ø±:</label>
          <div id="editableContent" contenteditable="true" style="width:100%;min-height:300px;padding:1.5rem;border:1px solid rgba(255,255,255,0.1);border-radius:.75rem;background:rgba(255,255,255,0.98);color:#1e293b;font-size:16px;line-height:1.8;overflow-y:auto;max-height:500px;column-count:2;column-gap:2rem;text-align:left;direction:ltr;"></div></div>
        <div style="display:flex;gap:.5rem;flex-wrap:wrap;">
          <button onclick="convertText()"    class="btn" style="background:rgba(6,40,20,0.5);color:#34d399;border:1px solid rgba(52,211,153,0.4);">âœ“ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ</button>
          <button onclick="clearAll()"       class="btn" style="background:rgba(40,20,0,0.5);color:#fbbf24;border:1px solid rgba(251,191,36,0.4);">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
          <button onclick="copyContent()"    class="btn" style="background:rgba(40,10,60,0.5);color:#a78bfa;border:1px solid rgba(167,139,250,0.4);">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ù†Øµ</button>
          <button onclick="downloadAsPDF()"  class="btn" style="background:rgba(60,10,40,0.5);color:#f9a8d4;border:1px solid rgba(249,168,212,0.4);">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ PDF</button>
        </div>
      </div>`;
      document.body.appendChild(modal);
      document.getElementById('textInput').addEventListener('input', convertText);
    }
    function formatText(cmd) { document.execCommand(cmd, false, null); document.getElementById('editableContent').focus(); }
    function highlightText(color) {
      const sel = window.getSelection(); if (!sel.rangeCount) return;
      const range = sel.getRangeAt(0), span = document.createElement('span');
      span.className = `highlight-${color}`; span.style.cssText = 'padding:2px 4px;border-radius:3px;';
      try { range.surroundContents(span); } catch { const c = range.extractContents(); span.appendChild(c); range.insertNode(span); }
      document.getElementById('editableContent').focus();
    }
    function increaseFontSize() { const c = document.getElementById('editableContent'); c.style.fontSize = (parseInt(window.getComputedStyle(c).fontSize) + 2) + 'px'; }
    function decreaseFontSize() { const c = document.getElementById('editableContent'); const sz = parseInt(window.getComputedStyle(c).fontSize); if (sz > 12) c.style.fontSize = (sz - 2) + 'px'; }
    function clearAll() { if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ØŸ')) return; document.getElementById('textInput').value = ''; document.getElementById('editableContent').innerHTML = ''; }
    function convertText() { const i = document.getElementById('textInput'), o = document.getElementById('editableContent'); if (i && o && !o.innerHTML) o.innerHTML = i.value.replace(/\n/g, '<br>'); }
    function copyContent() { const c = document.getElementById('editableContent'); const r = document.createRange(); r.selectNodeContents(c); const s = window.getSelection(); s.removeAllRanges(); s.addRange(r); try { document.execCommand('copy'); alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ âœ“'); } catch { alert('Ø­Ø¯Ø« Ø®Ø·Ø£'); } s.removeAllRanges(); }
    function downloadAsPDF() {
      const c = document.getElementById('editableContent');
      const pw = window.open('','','width=800,height=600');
      pw.document.write(`<!DOCTYPE html><html dir="ltr"><head><meta charset="UTF-8"><title>Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø­Ø±Ø±</title><style>body{font-family:'Segoe UI',sans-serif;padding:2cm;line-height:1.8;font-size:14pt;}.highlight-yellow{background:#FEF08A;padding:2px 4px;border-radius:3px;}.highlight-green{background:#BBF7D0;padding:2px 4px;border-radius:3px;}.highlight-blue{background:#BFDBFE;padding:2px 4px;border-radius:3px;}.highlight-pink{background:#FBCFE8;padding:2px 4px;border-radius:3px;}</style></head><body>${c.innerHTML}</body></html>`);
      pw.document.close(); pw.focus(); setTimeout(() => { pw.print(); pw.close(); }, 250);
    }

    /* â”€â”€ BRV (Built-in Reader/Viewer) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    let brvCurrentFile = { data: null, name: null };
    function brvDataURItoBlob(dataURI) {
      const parts = dataURI.split(','), mime = parts[0].split(':')[1].split(';')[0], raw = atob(parts[1]);
      const arr = new Uint8Array(raw.length); for (let i = 0; i < raw.length; i++) arr[i] = raw.charCodeAt(i);
      return new Blob([arr], { type: mime });
    }
    function showBRVModal(fileName) {
      brvCurrentFile.name = fileName;
      const modal = document.getElementById('brv-modal');
      document.getElementById('brv-title').textContent = fileName;
      document.getElementById('brv-content').innerHTML = '<div class="brv-loading"><div class="brv-spinner"></div><p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</p></div>';
      modal.style.display = 'flex';
      document.getElementById('brv-close-btn').onclick = () => { modal.style.display = 'none'; document.getElementById('brv-content').innerHTML = ''; };
      document.getElementById('brv-download-btn').onclick = () => brvLayer4Download(brvCurrentFile.data, brvCurrentFile.name);
    }
    async function openFile(fileData, fileName) {
      if (!fileData || !fileName) return;
      brvCurrentFile = { data: fileData, name: fileName };
      const isImg = /\.(jpg|jpeg|png|gif|webp|bmp|svg)$/i.test(fileName) || /^data:image\//i.test(fileData);
      const isPDF = /\.pdf$/i.test(fileName) || /^data:application\/pdf/i.test(fileData);
      showBRVModal(fileName);
      if (isImg)      brvShowImage(fileData);
      else if (isPDF) await brvLayer1PDF(fileData, fileName);
      else            brvLayer4Download(fileData, fileName);
    }
    function brvShowImage(fileData) { document.getElementById('brv-content').innerHTML = `<img src="${fileData}" style="max-width:100%;display:block;margin:auto;border-radius:8px;border:1px solid rgba(56,189,248,0.15);">`; }
    async function brvLayer1PDF(fileData, fileName) {
      const container = document.getElementById('brv-content');
      container.innerHTML = '<div class="brv-loading"><div class="brv-spinner"></div><p>Ø§Ù„Ø·Ø¨Ù‚Ø© 1: PDF.js</p><span class="brv-layer-badge">canvas rendering</span></div>';
      try {
        if (!window.pdfjsLib) {
          await new Promise((res, rej) => {
            const s = document.createElement('script');
            s.src = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js';
            s.onload = () => { window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js'; res(); };
            s.onerror = rej; document.head.appendChild(s);
          });
        }
        const pdf = await window.pdfjsLib.getDocument(fileData).promise;
        container.innerHTML = `<div class="brv-page-count">ğŸ“„ ${pdf.numPages} ØµÙØ­Ø©</div>`;
        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i), vp = page.getViewport({ scale: 1.5 });
          const canvas = document.createElement('canvas'); canvas.width = vp.width; canvas.height = vp.height; canvas.className = 'brv-page-canvas';
          await page.render({ canvasContext: canvas.getContext('2d'), viewport: vp }).promise;
          container.appendChild(canvas);
        }
      } catch(e) { console.warn('BRV L1 failed â†’', e); await brvLayer2Iframe(fileData, fileName); }
    }
    async function brvLayer2Iframe(fileData, fileName) {
      const container = document.getElementById('brv-content'); let blobURL = null;
      container.innerHTML = '<div class="brv-loading"><div class="brv-spinner"></div><p>Ø§Ù„Ø·Ø¨Ù‚Ø© 2: iframe</p><span class="brv-layer-badge">blob URL</span></div>';
      try {
        blobURL = URL.createObjectURL(brvDataURItoBlob(fileData));
        container.innerHTML = `<iframe id="brv-iframe" src="${blobURL}" class="brv-iframe"></iframe>`;
        await new Promise(r => setTimeout(r, 3000));
        const iframe = document.getElementById('brv-iframe');
        if (!iframe || iframe.contentDocument === null) { if (blobURL) URL.revokeObjectURL(blobURL); await brvLayer3Base64(fileData, fileName); }
        else setTimeout(() => { if (blobURL) URL.revokeObjectURL(blobURL); }, 60000);
      } catch(e) { console.warn('BRV L2 failed â†’', e); if (blobURL) URL.revokeObjectURL(blobURL); await brvLayer3Base64(fileData, fileName); }
    }
    async function brvLayer3Base64(fileData, fileName) {
      const container = document.getElementById('brv-content');
      container.innerHTML = `<object data="${fileData}" type="application/pdf" class="brv-iframe"><div class="brv-dl-screen"><div style="font-size:3rem;margin-bottom:1rem;">ğŸ“„</div><h3 style="margin:0 0 .5rem 0;">Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø¹Ø±Ø¶ PDF</h3><p style="color:#64748b;margin:0 0 1.5rem 0;">Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹</p></div></object>`;
      await new Promise(r => setTimeout(r, 3000)); brvLayer4Download(fileData, fileName, true);
    }
    function brvLayer4Download(fileData, fileName, silent = false) {
      const a = document.createElement('a'); a.href = fileData; a.download = fileName; a.style.display = 'none';
      document.body.appendChild(a); a.click();
      setTimeout(() => { if (document.body.contains(a)) document.body.removeChild(a); }, 1000);
      if (!silent) {
        const c = document.getElementById('brv-content');
        if (c) c.innerHTML = `<div class="brv-dl-screen"><div style="font-size:4rem;margin-bottom:1rem;">ğŸ“¥</div><h3 style="margin:0 0 .5rem 0;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</h3><p style="color:#64748b;margin:0 0 1.5rem 0;line-height:1.6;">Ø³ÙŠÙÙØªØ­ Ø§Ù„Ù…Ù„Ù ÙÙŠ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¬Ù‡Ø§Ø² ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.<br>Ø¥Ø°Ø§ Ù„Ù… ÙŠÙØªØ­ØŒ Ø§Ø¶ØºØ· Ø§Ù„Ø²Ø± Ø£Ø¯Ù†Ø§Ù‡.</p><button class="brv-btn brv-btn-dl" onclick="brvLayer4Download(brvCurrentFile.data,brvCurrentFile.name)">ğŸ“¥ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„</button></div>`;
      }
    }

    /* â”€â”€ Notification helper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function showNotification(msg, dur = 1500) {
      const ex = document.getElementById('notification'); if (ex) ex.remove();
      const n = document.createElement('div'); n.id = 'notification'; n.textContent = msg;
      n.style.animation = 'slideIn .3s ease-out';
      document.body.appendChild(n);
      setTimeout(() => { n.style.animation = 'slideOut .3s ease-out'; setTimeout(() => n.remove(), 300); }, dur);
    }
  </script>
</body>
</html>
